<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Going out during the day Visualization by Ulf Aslak. .vis { margin: 0 auto; height: 370px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-horizontal { stroke: #bdc3c7; stroke-width: 1; fill: none; stroke-dasharray: 10 5; } .line { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0.25; } .trendline { fill: none; stroke: red; stroke-width: 2.5; } .histEvent { stroke: grey; stroke-width: 2; stroke-opacity: 1; } ."><meta property="og:title" content="" />
<meta property="og:description" content="Going out during the day Visualization by Ulf Aslak. .vis { margin: 0 auto; height: 370px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-horizontal { stroke: #bdc3c7; stroke-width: 1; fill: none; stroke-dasharray: 10 5; } .line { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0.25; } .trendline { fill: none; stroke: red; stroke-width: 2.5; } .histEvent { stroke: grey; stroke-width: 2; stroke-opacity: 1; } ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://covid19.compute.dtu.dk/visualizations/where_people_are_going_out/" />
<meta property="article:modified_time" content="2020-05-08T10:32:24+02:00" />
<title>Where People Are Going Out | COVID-19 mobility</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.e72951d38884f3b48fa43ce2d729bd3729c1122733c26acf563840728c13c88f.css" integrity="sha256-5ylR04iE87SPpDzi1ym9NynBEiczwmrPVjhAcowTyI8=">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/dtu.png" alt="Logo" /><span>COVID-19 mobility</span>
  </a>
</h2>












  <ul>
<li><strong><a href="/">Main Page</a></strong></li>
<li><strong>Posts</strong>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><em>May</em>
<ul>
<li><a href="/posts/change_in_population_sizes/">11: What&rsquo;s happening in my city?</a></li>
<li><a href="/posts/population_landscape/">7: Population landscape</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Visualizations</strong>
<ul>
<li><em>Where people are</em>
<ul>
<li><a href="/visualizations/where_people_are_landscape/">Landscape</a></li>
<li><a href="/visualizations/where_people_are_going_out/"class=active>Going out</a></li>
<li><a href="/visualizations/where_people_are_change_in_population_size/">Change in population size</a></li>
<li><a href="/visualizations/where_people_are_population_concentration/">Population distribution</a></li>
</ul>
</li>
<li><em>How people move</em>
<ul>
<li><a href="/visualizations/how_people_move_distance_traveled/">Distance traveled</a></li>
<li><a href="/visualizations/how_people_move_staying_home/">Staying home</a></li>
</ul>
<!-- raw HTML omitted -->
</li>
</ul>
</li>
<li><strong>Data</strong>
<ul>
<li><a href="/data/population_density_maps/">Population Density Maps</a></li>
<li><a href="/data/movement_maps/">Movement Maps</a>
<!-- raw HTML omitted --></li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Where People Are Going Out</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="going-out-during-the-day"><strong>Going out during the day</strong></h1>
<span style="font-size:14px"><em>Visualization by <a href="mailto:ulfaslak@gmail.com">Ulf Aslak</a>.</em></span>




<style type="text/css">
	.vis {
		margin: 0 auto;
		height: 370px;
	}
	.line-baseline { 
		stroke: black;
		stroke-width: 1.5;
		fill: none;
		stroke-dasharray: 10 5;
		opacity: 0.2;
	}
	.line-horizontal { 
		stroke: #bdc3c7;
		stroke-width: 1;
		fill: none;
		stroke-dasharray: 10 5;
	}
	.line { 
		fill: none;
		stroke: black;
		stroke-width: 2;
		stroke-opacity: 0.25;
	}
	.trendline {
		fill: none; 
		stroke: red;
		stroke-width: 2.5;
	}
	.histEvent {
		stroke: grey;
		stroke-width: 2;
		stroke-opacity: 1;
	}
	.histEventDot {
		fill: grey;
	}
	.dot-baseline {
		fill: white;
		stroke: #2c3e50;
		stroke-width: 2;
		opacity: 0;
	}
	.dot {
		fill: black;
		opacity: 0.5;
	}
	.legend-label {
		text-anchor: start;
		font-weight: 300;
		cursor: pointer;
	}
	.right-legend {
		font-size: 12px;
	}
	.tooltip {	
		position: absolute;
		top: 0;
		line-height: 1;
		font-weight: 500;
		padding: 12px;
		background: rgba(0, 0, 0, 0.8);
		color: #fff;
		border-radius: 2px;	
	}
	.toggle {
		-webkit-user-select: none;          
		-moz-user-select: none;  
		-ms-user-select: none;  
		user-select: none;  
	}
	.radio-group {
		position: absolute;
		border: solid 1px #999999;
		display: inline-block;
		border-radius: 5px;
		overflow: hidden;
	}
	.select-place {
		position: absolute;
		right: 0px;
	}
	.flex {
		display: flex;
	}
</style>






<div style="max-height: 0px">
	<svg>
	  <defs>
	    <pattern id="lines" height="10" width="10" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
	      <line x1="0" y1="4" x2="10" y2="4" stroke-width="2" stroke="black"/>
	    </pattern>
	  </defs>
	</svg>
	<svg>
	  <defs>
	    <pattern id="thinlines" height="5" width="5" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
	      <line x1="0" y1="1" x2="10" y2="1" stroke-width="0.5" stroke="grey"/>
	    </pattern>
	  </defs>
	</svg>
</div>






<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://unpkg.com/d3-simple-slider"></script>
<script src="https://unpkg.com/chroma-js@2.0.3/chroma.min.js"></script>

<script>

	
	
	let eventDates = [
		["2020-03-11 00:00:00", 'PM announces lockdown starting March 16', 'event1'],
		["2020-03-16 00:00:00", 'Lockdown officially begins', 'event2'],
		["2020-04-09 00:00:00", 'Skærtorsdag (public holiday during Easter)', 'event3'],
		["2020-04-10 00:00:00", 'Lockdown relaxations announced', 'event4'],
		["2020-04-15 00:00:00", 'Child-care soft-reopens', 'event5'],
		["2020-04-20 00:00:00", 'Small businesses open', 'event6'],
		["2020-04-27 00:00:00", 'IKEA opens (controversy)', 'event7'],
		["2020-05-08 00:00:00", 'Great prayer day (public holiday)', 'event8'],
		
		
	]

	let startDate = "2020-03-10 00:00:00";

	
	let tooltip = d3.select("body").append("div")
		.attr("class", "tooltip")
		.style("display", "none");

	
	let parseDate = d3.timeParse("%Y-%m-%d %H:%M:%S");
	let formatDate = d3.timeFormat("%e %B");

	
	let margin = {top: 70, right: 88, bottom: 30, left: 60},
		figureHeight = 370;



	
	

	
	function mouseover(d) {
		tooltip.style("display", "inline");
	}

	function mouseout(d) {
		tooltip.style("display", "none");
	}

	function mousemoveHistEvent(d) {
		tooltip
			.html("Date: <b>" + formatDate(parseDate(d[0])) + "</b><br>" + d[1] + "</b>")
			.style("left", (d3.event.pageX) + "px")
			.style("top", (d3.event.pageY) + "px");
	}

	
	function adjustBaseline(datum) {
		datumy = d3.range(7).map(() => []);
		datum.forEach((d, i) => {
		    datumy[i%7].push(d[1]);
		});
		datumy = datumy.map(d => d3.mean(d));
		return datum.map((d, i) => [d[0], datumy[i%7]]);
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	function round(val, order) {
		return Math.round(val * order) / order;
	}

	Date.prototype.addDays = function(n) {
	    let date = new Date(this.valueOf());
	    date.setDate(date.getDate() + n);
	    return date;
	}

	function weekavg(y) {
		let y_avg = [];
		y.forEach((v, i) => {
			let i0 = Math.max(0, i-3);
			let i1 = Math.min(y.length-1, i+4);
			y_avg.push(d3.mean(y.slice(i0, i1)));
		});
		return y_avg;
	}
</script>
<p>By looking at how the number of people spending most of their time in a given area changes between working hours (10–18) and non-working hours (18–02) we can assess how many individuals leave their home during the day (for example to go to work). We use the following reasoning: if 80 people spent most of their time in a given tile during working hours and the number is 100 during non-working hours (allowing us to assume that 100 people live there), we can say that 20 people were not at home during the working hours of the day. This is not a perfect measure, as work and home areas are not fully seperated, so the numbers we report are a lower bound, as some people will work very near home, or work where others live. <em>The important to look for here is how the daily measurements deviate from the baseline.</em></p>
<p>Note that this figure is similar to the the one presented in &lsquo;<strong>Visualizations</strong> &gt; <em>How people move</em> &gt; Staying at home&rsquo;. The figures measure essentially the same thing, but from different perspectives using different datasets.</p>
<style type="text/css">
	input.working[type=radio] {
		position: absolute;
		visibility: hidden;
		display: none;
	}

	label.working {
		color: #222222;
		display: inline-block;
		font-size: 12px;
		font-weight: 500;
		padding: 0px 5px 0px 5px;
	}

	input.working[type=radio]:checked + label.working{
		color: #ffffff;
		background: #555555;
		cursor: pointer;
	}

	label.working + input.working[type=radio] + label.working {
		border-left: solid 1px #999999;
		cursor: pointer;
	}
</style>

<div class="flex">
	<div class="flex"></div>
	<div class="select-place-working">
		<select id="levelWorking">
			<option value="all"><em>Whole country</em></option>
			<option value="Aabenraa">Aabenraa</option>
			<option value="Aalborg">Aalborg</option>
			<option value="Aarhus">Aarhus</option>
			<option value="Albertslund">Albertslund</option>
			<option value="Allerød">Allerød</option>
			<option value="Assens">Assens</option>
			<option value="Ballerup">Ballerup</option>
			<option value="Billund">Billund</option>
			<option value="Brøndby">Brøndby</option>
			<option value="Brønderslev">Brønderslev</option>
			<option value="Dragør">Dragør</option>
			<option value="Egedal">Egedal</option>
			<option value="Esbjerg">Esbjerg</option>
			<option value="Faaborg-Midtfyn">Faaborg-Midtfyn</option>
			<option value="Fanø">Fanø</option>
			<option value="Favrskov">Favrskov</option>
			<option value="Faxe">Faxe</option>
			<option value="Fredensborg">Fredensborg</option>
			<option value="Fredericia">Fredericia</option>
			<option value="Frederiksberg">Frederiksberg</option>
			<option value="Frederikshavn">Frederikshavn</option>
			<option value="Frederikssund">Frederikssund</option>
			<option value="Furesø">Furesø</option>
			<option value="Gentofte">Gentofte</option>
			<option value="Gladsaxe">Gladsaxe</option>
			<option value="Glostrup">Glostrup</option>
			<option value="Greve">Greve</option>
			<option value="Gribskov">Gribskov</option>
			<option value="Guldborgsund">Guldborgsund</option>
			<option value="Haderslev">Haderslev</option>
			<option value="Halsnæs">Halsnæs</option>
			<option value="Hedensted">Hedensted</option>
			<option value="Helsingør">Helsingør</option>
			<option value="Herlev">Herlev</option>
			<option value="Herning">Herning</option>
			<option value="Hillerød">Hillerød</option>
			<option value="Hjørring">Hjørring</option>
			<option value="Holbæk">Holbæk</option>
			<option value="Holstebro">Holstebro</option>
			<option value="Horsens">Horsens</option>
			<option value="Hvidovre">Hvidovre</option>
			<option value="Høje-Taastrup">Høje-Taastrup</option>
			<option value="Hørsholm">Hørsholm</option>
			<option value="Ikast-Brande">Ikast-Brande</option>
			<option value="Ishøj">Ishøj</option>
			<option value="Jammerbugt">Jammerbugt</option>
			<option value="Kalundborg">Kalundborg</option>
			<option value="Kerteminde">Kerteminde</option>
			<option value="Kolding">Kolding</option>
			<option value="København">København</option>
			<option value="Køge">Køge</option>
			<option value="Langeland">Langeland</option>
			<option value="Lejre">Lejre</option>
			<option value="Lemvig">Lemvig</option>
			<option value="Lolland">Lolland</option>
			<option value="Lyngby-Taarbæk">Lyngby-Taarbæk</option>
			<option value="Læsø">Læsø</option>
			<option value="Mariagerfjord">Mariagerfjord</option>
			<option value="Middelfart">Middelfart</option>
			<option value="Morsø">Morsø</option>
			<option value="Norddjurs">Norddjurs</option>
			<option value="Nordfyns">Nordfyns</option>
			<option value="Nyborg">Nyborg</option>
			<option value="Næstved">Næstved</option>
			<option value="Odder">Odder</option>
			<option value="Odense">Odense</option>
			<option value="Odsherred">Odsherred</option>
			<option value="Randers">Randers</option>
			<option value="Rebild">Rebild</option>
			<option value="Ringkøbing-Skjern">Ringkøbing-Skjern</option>
			<option value="Ringsted">Ringsted</option>
			<option value="Roskilde">Roskilde</option>
			<option value="Rudersdal">Rudersdal</option>
			<option value="Rødovre">Rødovre</option>
			<option value="Samsø">Samsø</option>
			<option value="Silkeborg">Silkeborg</option>
			<option value="Skanderborg">Skanderborg</option>
			<option value="Skive">Skive</option>
			<option value="Slagelse">Slagelse</option>
			<option value="Solrød">Solrød</option>
			<option value="Sorø">Sorø</option>
			<option value="Stevns">Stevns</option>
			<option value="Struer">Struer</option>
			<option value="Svendborg">Svendborg</option>
			<option value="Syddjurs">Syddjurs</option>
			<option value="Sønderborg">Sønderborg</option>
			<option value="Thisted">Thisted</option>
			<option value="Tårnby">Tårnby</option>
			<option value="Tønder">Tønder</option>
			<option value="Vallensbæk">Vallensbæk</option>
			<option value="Varde">Varde</option>
			<option value="Vejen">Vejen</option>
			<option value="Vejle">Vejle</option>
			<option value="Vesthimmerlands">Vesthimmerlands</option>
			<option value="Viborg">Viborg</option>
			<option value="Vordingborg">Vordingborg</option>
			<option value="Ærø">Ærø</option>
		</select>
	</div>
</div>

<div class='vis' id='vis-working'></div>





<script src="https://d3js.org/d3.v5.min.js"></script>


<script>

	function workingvis() {

		
		

		let data, datum, time;
		let level = "all",
			mode = 'count';


		
		

		
		let maindiv = document.getElementById("vis-working")
		let width = maindiv.offsetWidth - margin.left - margin.right,
			height = figureHeight - margin.top - margin.bottom;

		
		let x = d3.scaleTime().range([0, width]);
		let y = d3.scaleLinear().range([height, 0]);

		
		let xAxis = d3.axisBottom(x);
		let yAxis = d3.axisLeft(y).ticks(6);

		
		let valueline = d3.line()
			.x(function(d) { return x(d[0]); })
			.y(function(d) { return y(d[1]); });

		
		let svg = d3.select("#vis-working")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
						"translate(" + margin.left + "," + margin.top + ")");

		
		svg.append("text")
			.attr("x", width/2)
			.attr("y", -15)
			.style("text-anchor", "middle")
			.style("font-weight", 700)
			.text("Going out during working hours");

		
		svg.append("text")
			.attr("x", -60)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", 'toggleRelativeworking')
			.style("text-anchor", "left")
			.style("font-weight", 300)
			.style('cursor', 'pointer')
			.text("rel")
			.on('click', handleTextClickWorking);

		
		svg.append("text")
			.attr("x", -37)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", "toggleAbsworking")
			.style("text-anchor", "left")
			.style("font-weight", 700)
			.style('cursor', 'pointer')
			.text("abs")
			.on('click', handleTextClickWorking);

		
		
		d3.json("/data/night_day_difference.json").then(function(data_) {

			
			data = data_;

			
			time = data._meta.datetime.map(d => parseDate(d));
			let dt = d3.max(time);
			let d0 = parseDate(startDate);
			let n_days = (dt - d0 + 3.6e6) / 86.4e6
			let time_shown = d3.range(n_days+1).map(n => d0.addDays(n));

			
			let yrange = [-0.05, 0.3]
			x.domain(d3.extent(time_shown));
			y.domain(yrange);

			
			let idxwknd = d3.range(4, time_shown.length, 7);
			let dx = x(time[2]) - x(time[0]);
			let dy = y(yrange[0]) - y(yrange[1]);
			svg.selectAll('shade')
				.data(idxwknd)
				.enter().append("rect")
				.attr("class", "shade")
				.attr("x", d => {
					return d == 0 ? x(time_shown[d]) : x(time_shown[d]) - dx/4
				})
				.attr("y", d => y(yrange[1]))
				.attr("width", d => {
					if (d == 0 | d == time_shown.length - 2) {
						return dx * 3/4;
					} else if (d == time_shown.length - 1) {
						return dx * 1/4;
					} else {
						return dx;
					}
				})
				.attr("height", dy)
				.style('fill', '#ecf0f1')
				.style('fill-opacity', 1)

			
			svg.append('rect')
				.attr('x', x(time_shown[0]))
				.attr('y', y(yrange[1]))
				.attr('width', x(time[0]) - x(time_shown[0]))
				.attr('height', dy)
				.attr('fill', 'url(#lines)')
				.attr('stroke-width', 1.5)
				.attr('fill-opacity', 0.2)
			svg.append('text')
				.attr('x', 10)
				.attr('y', 20)
				.style("font-weight", 0)
				.style("font-size", "12px")
				.text('NO DATA')

			
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			
			for (let d of eventDates) {  
				svg.append('line')
					.attr('class', 'histEvent')
					.attr('id', d[2] + "working")
					.attr('x1', x(parseDate(d[0])))
					.attr('x2', x(parseDate(d[0])))
					.attr('y1', height)
					.attr('y2', height)
				svg.append('circle')
					.attr('class', 'histEventDot')
					.attr('cx', x(parseDate(d[0])))
					.attr('cy', height)
					.attr('r', 3)
					.on('mouseover', mouseover)
					.on('mousemove', () => {
						mousemoveHistEvent(d);
						d3.select("#" + d[2] + "working").attr('y2', 0)
					})
					.on('mouseout', () => {
						mouseout();
						d3.select("#" + d[2] + "working").attr('y2', height)
					})
			}

			
			svg.append('line')
				.attr('class', 'line')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 10)
				.attr('y2', 10)
			svg.append('circle')
				.attr('class', 'dot')
				.attr('cx', width+20)
				.attr('cy', 10)
				.attr('r', 2.5)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 10+4)
				.text('daily')
			svg.append('line')
				.attr('class', 'line-baseline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 30)
				.attr('y2', 30)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 30+4)
				.text('baseline')
			svg.append('line')
				.attr('class', 'trendline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 50)
				.attr('y2', 50)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 50+4)
				.text('7 day avg')
			
			visualize(data, level);
		})

		d3.select('#levelWorking')
			.on("change", () => {
				let dropdown = document.getElementById("levelWorking");
				level = dropdown.options[dropdown.selectedIndex].value;
				d3.selectAll("#dataWorking").remove();
				visualize(data, level);
			});

		
		
		function visualize(data, level) {

			if (mode == 'count') {
				yAxis = d3.axisLeft(y).tickFormat(v => v/1e3 + "k")
			} else if (mode == 'relative') {
				yAxis = d3.axisLeft(y).ticks(6, ".0%")
			}

			if (mode == 'count') {
				yrange = [0, d3.max([...data[level]['baseline'], ...data[level]['crisis']])*1.2]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataWorking")
					.call(yAxis);

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataWorking")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Number of people");

				
				datum = zip(time, data[level]['baseline']);
				datum = adjustBaseline(datum);
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-baseline')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot-baseline")
					.attr("id", "dataWorking")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 3.5)
					.on('mouseover', d => {
						mouseover(d);
					})
					.on('mousemove', d => {
						mousemoveDot(d);
					})
					.on("mouseout", d => {
						mouseout(d);
					});
				datum = zip(time, weekavg(data[level]['crisis']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				datum = zip(time, data[level]['crisis'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				datum = zip(time, data[level]['crisis'])
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataWorking")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', d => {
						mouseover(d);
					})
					.on('mousemove', d => {
						mousemoveDot(d);
					})
					.on("mouseout", d => {
						mouseout(d);
					});

			} else if (mode == 'relative') {
				yrange = [d3.min(data[level]['percent_change'])-0.1, d3.max(data[level]['percent_change'])+0.1]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataWorking")
					.call(yAxis);

				
				datum = zip([parseDate(startDate), ...time], d3.range(time.length+1).map(() => 0))
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-horizontal')
					.attr("id", "dataWorking")
					.attr('d', valueline)

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataWorking")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Deviation from baseline");

				
				datum = zip(time, weekavg(data[level]['percent_change']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				datum = zip(time, data[level]['percent_change'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				datum = zip(time, data[level]['percent_change'])
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataWorking")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);
			}
		}

		
		

		
		function mousemoveDot(d) {
			let tooltiptext;
			if (mode == 'relative') {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Deviation: <b>" + round(d[1]*100, 1e1) + "%</b>"
			} else {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Population: <b>" + round(d[1], 1e0) + "</b>"
			}

			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX) + "px")
				.style("top", (d3.event.pageY) + "px");
		}
		function handleTextClickWorking() {
			if (mode == 'count') {
				d3.select('#toggleRelativeworking')
					.style('font-weight', 700);
				d3.select('#toggleAbsworking')
					.style('font-weight', 300);
				mode = "relative";
			} else {
				d3.select('#toggleRelativeworking')
					.style('font-weight', 300);
				d3.select('#toggleAbsworking')
					.style('font-weight', 700);
				mode = "count";
			}
			d3.selectAll("#dataWorking").remove();
			visualize(data, level);
		}
		function update0() {
			d3.selectAll("#dataWorking").remove();
			level = 'all';
			visualize(data, level);
		}
		function update1() {
			d3.selectAll("#dataWorking").remove();
			level = 'within_kommune';
			visualize(data, level);
		}
		function update2() {
			d3.selectAll("#dataWorking").remove();
			level = 'within_region';
			visualize(data, level);
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2
		}
	}

	
	let instance_working = workingvis()

	
	function adjustBaseline(datum) {
		datumy = d3.range(7).map(() => []);
		datum.forEach((d, i) => {
		    datumy[i%7].push(d[1])
		})
		datumy = datumy.map(d => d3.mean(d))
		return datum.map((d, i) => [d[0], datumy[i%7]])
	}
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	function round(val, order) {
		return Math.round(val * order) / order;
	}

	Date.prototype.addDays = function(n) {
	    let date = new Date(this.valueOf());
	    date.setDate(date.getDate() + n);
	    return date;
	}
</script>
<blockquote>
<p><strong>This figure is interactive!</strong> You can:</p>
<ul>
<li>Change the municipality displayed using the <strong>dropdown menu</strong>.</li>
<li>Toggle whether the y-axis displays the absolute measurements (rel<span style="color:white">/</span><strong>abs</strong>) or the deviation from the baseline (<strong>rel</strong><span style="color:white">/</span>abs).</li>
<li><strong>Hover</strong> the curves to see precise values.</li>
<li><strong>Hover</strong> the marks on the x-axis to see events.</li>
</ul>
</blockquote>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












