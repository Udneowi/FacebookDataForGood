<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Population density during lockdown Report by Ulf Aslak, Laura Alessandretti, and Sune Lehmann. Updated: May, 6, 2020 21:29:46
.vis { margin: 0 auto; height: 370px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-horizontal { stroke: #bdc3c7; stroke-width: 1; fill: none; stroke-dasharray: 10 5; } .line { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0.25; } .trendline { fill: none; stroke: red; stroke-width: 2."><meta property="og:title" content="Population density" />
<meta property="og:description" content="Population density during lockdown Report by Ulf Aslak, Laura Alessandretti, and Sune Lehmann. Updated: May, 6, 2020 21:29:46
.vis { margin: 0 auto; height: 370px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-horizontal { stroke: #bdc3c7; stroke-width: 1; fill: none; stroke-dasharray: 10 5; } .line { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0.25; } .trendline { fill: none; stroke: red; stroke-width: 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://covid19.compute.dtu.dk/mobility/population/" />
<meta property="article:modified_time" content="2020-05-06T21:29:46+02:00" />
<title>Population density | COVID-19 mobility</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.e72951d38884f3b48fa43ce2d729bd3729c1122733c26acf563840728c13c88f.css" integrity="sha256-5ylR04iE87SPpDzi1ym9NynBEiczwmrPVjhAcowTyI8=">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/dtu.png" alt="Logo" /><span>COVID-19 mobility</span>
  </a>
</h2>












  <ul>
<li><strong><a href="/">Main Page</a></strong></li>
<li><strong>Posts</strong>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><em>May</em>
<ul>
<li><a href="/posts/change_in_population_sizes/">11: What&rsquo;s happening in my city?</a></li>
<li><a href="/posts/population_landscape/">7: Population landscape</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Visualizations</strong>
<ul>
<li><em>Where people are</em>
<ul>
<li><a href="/visualizations/where_people_are_landscape/">Landscape</a></li>
<li><a href="/visualizations/where_people_are_going_out/">Going out</a></li>
<li><a href="/visualizations/where_people_are_change_in_population_size/">Change in population size</a></li>
<li><a href="/visualizations/where_people_are_population_concentration/">Population distribution</a></li>
</ul>
</li>
<li><em>How people move</em>
<ul>
<li><a href="/visualizations/how_people_move_distance_traveled/">Distance traveled</a></li>
<li><a href="/visualizations/how_people_move_staying_home/">Staying home</a></li>
</ul>
<!-- raw HTML omitted -->
</li>
</ul>
</li>
<li><strong>Data</strong>
<ul>
<li><a href="/data/population_density_maps/">Population Density Maps</a></li>
<li><a href="/data/movement_maps/">Movement Maps</a>
<!-- raw HTML omitted --></li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Population density</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="population-density-during-lockdown"><strong>Population density during lockdown</strong></h1>
<p><span style="font-size:14px"><em>Report by <a href="mailto:ulfaslak@gmail.com">Ulf Aslak</a>, <a href="mailto:l.alessandretti@gmail.com">Laura Alessandretti</a>, and <a href="mailto:sljo@dtu.dk">Sune Lehmann</a>.</em></span> <span style="font-size:14px"><em>Updated: May, 6, 2020 21:29:46</em></span></p>




<style type="text/css">
	.vis {
		margin: 0 auto;
		height: 370px;
	}
	.line-baseline { 
		stroke: black;
		stroke-width: 1.5;
		fill: none;
		stroke-dasharray: 10 5;
		opacity: 0.2;
	}
	.line-horizontal { 
		stroke: #bdc3c7;
		stroke-width: 1;
		fill: none;
		stroke-dasharray: 10 5;
	}
	.line { 
		fill: none;
		stroke: black;
		stroke-width: 2;
		stroke-opacity: 0.25;
	}
	.trendline {
		fill: none; 
		stroke: red;
		stroke-width: 2.5;
	}
	.histEvent {
		stroke: grey;
		stroke-width: 2;
		stroke-opacity: 1;
	}
	.histEventDot {
		fill: grey;
	}
	.dot-baseline {
		fill: white;
		stroke: #2c3e50;
		stroke-width: 2;
		opacity: 0;
	}
	.dot {
		fill: black;
		opacity: 0.5;
	}
	.legend-label {
		text-anchor: start;
		font-weight: 300;
		cursor: pointer;
	}
	.right-legend {
		font-size: 12px;
	}
	.tooltip {	
		position: absolute;
		top: 0;
		line-height: 1;
		font-weight: 500;
		padding: 12px;
		background: rgba(0, 0, 0, 0.8);
		color: #fff;
		border-radius: 2px;	
	}
	.toggle {
		-webkit-user-select: none;          
		-moz-user-select: none;  
		-ms-user-select: none;  
		user-select: none;  
	}
	.radio-group {
		position: absolute;
		border: solid 1px #999999;
		display: inline-block;
		border-radius: 5px;
		overflow: hidden;
	}
	.select-place {
		position: absolute;
		right: 0px;
	}
	.flex {
		display: flex;
	}
</style>






<div style="max-height: 0px">
	<svg>
	  <defs>
	    <pattern id="lines" height="10" width="10" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
	      <line x1="0" y1="4" x2="10" y2="4" stroke-width="2" stroke="black"/>
	    </pattern>
	  </defs>
	</svg>
	<svg>
	  <defs>
	    <pattern id="thinlines" height="5" width="5" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
	      <line x1="0" y1="1" x2="10" y2="1" stroke-width="0.5" stroke="grey"/>
	    </pattern>
	  </defs>
	</svg>
</div>






<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://unpkg.com/d3-simple-slider"></script>
<script src="https://unpkg.com/chroma-js@2.0.3/chroma.min.js"></script>

<script>

	
	
	let eventDates = [
		["2020-03-11 00:00:00", 'PM announces lockdown starting March 16', 'event1'],
		["2020-03-16 00:00:00", 'Lockdown officially begins', 'event2'],
		["2020-04-09 00:00:00", 'Skærtorsdag (public holiday during Easter)', 'event3'],
		["2020-04-10 00:00:00", 'Lockdown relaxations announced', 'event4'],
		["2020-04-15 00:00:00", 'Child-care soft-reopens', 'event5'],
		["2020-04-20 00:00:00", 'Small businesses open', 'event6'],
		["2020-04-27 00:00:00", 'IKEA opens (controversy)', 'event7'],
		["2020-05-08 00:00:00", 'Great prayer day (public holiday)', 'event8'],
		
		
	]

	let startDate = "2020-03-10 00:00:00";

	
	let tooltip = d3.select("body").append("div")
		.attr("class", "tooltip")
		.style("display", "none");

	
	let parseDate = d3.timeParse("%Y-%m-%d %H:%M:%S");
	let formatDate = d3.timeFormat("%e %B");

	
	let margin = {top: 70, right: 88, bottom: 30, left: 60},
		figureHeight = 370;



	
	

	
	function mouseover(d) {
		tooltip.style("display", "inline");
	}

	function mouseout(d) {
		tooltip.style("display", "none");
	}

	function mousemoveHistEvent(d) {
		tooltip
			.html("Date: <b>" + formatDate(parseDate(d[0])) + "</b><br>" + d[1] + "</b>")
			.style("left", (d3.event.pageX) + "px")
			.style("top", (d3.event.pageY) + "px");
	}

	
	function adjustBaseline(datum) {
		datumy = d3.range(7).map(() => []);
		datum.forEach((d, i) => {
		    datumy[i%7].push(d[1]);
		});
		datumy = datumy.map(d => d3.mean(d));
		return datum.map((d, i) => [d[0], datumy[i%7]]);
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	function round(val, order) {
		return Math.round(val * order) / order;
	}

	Date.prototype.addDays = function(n) {
	    let date = new Date(this.valueOf());
	    date.setDate(date.getDate() + n);
	    return date;
	}

	function weekavg(y) {
		let y_avg = [];
		y.forEach((v, i) => {
			let i0 = Math.max(0, i-3);
			let i1 = Math.min(y.length-1, i+4);
			y_avg.push(d3.mean(y.slice(i0, i1)));
		});
		return y_avg;
	}
</script>
<p>An important aspect of understanding how the lockdown affects mobility is <em>how the population is re-distributed across the country.</em></p>
<ul>
<li>Do people stay in their homes or do they move to less populated spaces?</li>
<li>How is population density in the cities impacted?</li>
<li>What is the development over time?</li>
<li>Can we find signs of normality in the population distribution as the country opens up?</li>
</ul>
<p>In this (continuously updated) report we will address these and related questions. Data for this report are so-called &ldquo;Population density maps&rdquo; and were provided by the Facebook&rsquo;s <a href="https://dataforgood.fb.com/">Data for Good</a> initiative; please see the section <em>Data description</em> at the bottom of this page for descriptive details, and notes on privacy and limitations.</p>
<h2 id="visualizing-population-distribution"><strong>Visualizing population distribution</strong></h2>
<p>The population density maps describe the number of people in <em>tiles</em> (square areas) throughout the country at different time-intervals.</p>
<p>In the two figures below we plot tiles with a <strong>height</strong> that corresponds to their baseline—pre-lockdown—count (how many people are usually in this tile), and a <strong>color</strong> that corresponds to the percentage change from that baseline (how did the population in that tile change).</p>
<p>Maximally <strong><span style="color:#c0392b">red tiles</span></strong> contain less than half of the people they usually contain (≤ –50% deviation from baseline). Maximally <strong><span style="color:#009432">green tiles</span></strong> contain more than one and a half times their usual count (≥ 50% deviation from baseline).</p>
<blockquote>
<p><strong>Visualization</strong>: The following sections <em>Country and region</em> and <em>Urban agglomeration</em> highlight observations that can be made by exploring our interactive map visualization of the Population density maps. <a href="/mobility/popdensevis/index.html">Click here to inspect the data yourself</a>.
To change the map angle, hold <kbd>shift</kbd> or <kbd>alt</kbd> while panning.</p>
</blockquote>
<h3 id="country-and-region"><strong>Country and region</strong></h3>
<p><em>Question: How does the overall population distribution change when people cease work or can work from anywhere?</em>
<div class="book-columns flex flex-wrap">
  
  <div class="flex-even markdown-inner">
    <strong>Denmark</strong>
<img src="/popdensview1.png" alt="img">
  </div>
  
  <div class="flex-even markdown-inner">
    <strong>Region Hovedstaden</strong>
<img src="/popdensview2.png" alt="img">
  </div>
  
</div>
</p>
<p><strong>Observation 1:</strong> <em>Large parts of the population have left the cities.</em> The data shown above is from Monday April 6, night (18–02), a time when people are normally at home. The tall red tiles in urban areas reveal that people who live there are not at home. The pattern is found throughout the lockdown.</p>
<p><strong>Observation 2:</strong> <em>Holiday areas become densely populated.</em> A closer look at &lsquo;Region Hovedstaden&rsquo; reveals very high population counts near coastal areas known to contain holiday homes, in some tiles with over 100% deviation from baseline (read more about regional population change under <em>Local population deviation</em> below).</p>
<h3 id="urban-agglomeration"><strong>Urban agglomeration</strong></h3>
<p><em>Question: How does the population distribution during work hours (18–02) around cities change when workers are sent home?</em>
<div class="book-columns flex flex-wrap">
  
  <div class="flex-even markdown-inner">
    Around <strong>Aarhus</strong>
<img src="/popdens_aarhus.png" alt="img">
  </div>
  
  <div class="flex-even markdown-inner">
    Around <strong>Odense</strong>
<img src="/popdens_odense.png" alt="img">
  </div>
  
  <div class="flex-even markdown-inner">
    Around <strong>Copenhagen</strong>
<img src="/popdens_copenhagen.png" alt="img">
  </div>
  
</div>
</p>
<p><strong>Observation 3:</strong> <em>Places where people work (inner city, industrial areas, airports) become <span style="color:#c0392b">relatively empty</span> during work hours. Places where people live (outskirts, rural areas) become <span style="color:#009432">more populated</span></em>. In the figure above we visualize population counts around metropolitan areas for working hours (10–18). It is not surprising that we see places associated with work decline significantly in population during work hours, and reversely that places where people live boom; this is simply the effect of work moving into peoples homes.</p>
<h2 id="analyses"><strong>Analyses</strong></h2>
<p>A key thing that we are interested in is <em>changes over time</em>. Below we look into various aspects that help us understand and quantify the changes we observe on the map.</p>
<h3 id="leaving-home-during-the-day"><strong>Leaving home during the day</strong></h3>
<p>By looking at how the number of people spending most of their time in a given area changes between working hours (10–18) and non-working hours (18–02) we can assess how many individuals leave their home during the day (for example to go to work). We use the following reasoning: if 80 people spent most of their time in a given tile during working hours and the number is 100 during non-working hours (allowing us to assume that 100 people live there), we can say that 20 people were not at home during the working hours of the day. This is not a perfect measure, as work and home areas are not fully seperated, so the numbers we report are a lower bound, as some people will work very near home, or work where others live. <em>The important to look for here is how the daily measurements deviate from the baseline.</em></p>
<p>Note that you can interact with the figure below. You can:</p>
<ol>
<li>Change the municipality displayed using the <strong>dropdown menu</strong>.</li>
<li>Toggle whether the y-axis displays the absolute measurements (rel<span style="color:white">/</span><strong>abs</strong>) or the deviation from the baseline (<strong>rel</strong><span style="color:white">/</span>abs).</li>
</ol>
<style type="text/css">
	input.working[type=radio] {
		position: absolute;
		visibility: hidden;
		display: none;
	}

	label.working {
		color: #222222;
		display: inline-block;
		font-size: 12px;
		font-weight: 500;
		padding: 0px 5px 0px 5px;
	}

	input.working[type=radio]:checked + label.working{
		color: #ffffff;
		background: #555555;
		cursor: pointer;
	}

	label.working + input.working[type=radio] + label.working {
		border-left: solid 1px #999999;
		cursor: pointer;
	}
</style>

<div class="flex">
	<div class="flex"></div>
	<div class="select-place-working">
		<select id="levelWorking">
			<option value="all"><em>Whole country</em></option>
			<option value="Aabenraa">Aabenraa</option>
			<option value="Aalborg">Aalborg</option>
			<option value="Aarhus">Aarhus</option>
			<option value="Albertslund">Albertslund</option>
			<option value="Allerød">Allerød</option>
			<option value="Assens">Assens</option>
			<option value="Ballerup">Ballerup</option>
			<option value="Billund">Billund</option>
			<option value="Brøndby">Brøndby</option>
			<option value="Brønderslev">Brønderslev</option>
			<option value="Dragør">Dragør</option>
			<option value="Egedal">Egedal</option>
			<option value="Esbjerg">Esbjerg</option>
			<option value="Faaborg-Midtfyn">Faaborg-Midtfyn</option>
			<option value="Fanø">Fanø</option>
			<option value="Favrskov">Favrskov</option>
			<option value="Faxe">Faxe</option>
			<option value="Fredensborg">Fredensborg</option>
			<option value="Fredericia">Fredericia</option>
			<option value="Frederiksberg">Frederiksberg</option>
			<option value="Frederikshavn">Frederikshavn</option>
			<option value="Frederikssund">Frederikssund</option>
			<option value="Furesø">Furesø</option>
			<option value="Gentofte">Gentofte</option>
			<option value="Gladsaxe">Gladsaxe</option>
			<option value="Glostrup">Glostrup</option>
			<option value="Greve">Greve</option>
			<option value="Gribskov">Gribskov</option>
			<option value="Guldborgsund">Guldborgsund</option>
			<option value="Haderslev">Haderslev</option>
			<option value="Halsnæs">Halsnæs</option>
			<option value="Hedensted">Hedensted</option>
			<option value="Helsingør">Helsingør</option>
			<option value="Herlev">Herlev</option>
			<option value="Herning">Herning</option>
			<option value="Hillerød">Hillerød</option>
			<option value="Hjørring">Hjørring</option>
			<option value="Holbæk">Holbæk</option>
			<option value="Holstebro">Holstebro</option>
			<option value="Horsens">Horsens</option>
			<option value="Hvidovre">Hvidovre</option>
			<option value="Høje-Taastrup">Høje-Taastrup</option>
			<option value="Hørsholm">Hørsholm</option>
			<option value="Ikast-Brande">Ikast-Brande</option>
			<option value="Ishøj">Ishøj</option>
			<option value="Jammerbugt">Jammerbugt</option>
			<option value="Kalundborg">Kalundborg</option>
			<option value="Kerteminde">Kerteminde</option>
			<option value="Kolding">Kolding</option>
			<option value="København">København</option>
			<option value="Køge">Køge</option>
			<option value="Langeland">Langeland</option>
			<option value="Lejre">Lejre</option>
			<option value="Lemvig">Lemvig</option>
			<option value="Lolland">Lolland</option>
			<option value="Lyngby-Taarbæk">Lyngby-Taarbæk</option>
			<option value="Læsø">Læsø</option>
			<option value="Mariagerfjord">Mariagerfjord</option>
			<option value="Middelfart">Middelfart</option>
			<option value="Morsø">Morsø</option>
			<option value="Norddjurs">Norddjurs</option>
			<option value="Nordfyns">Nordfyns</option>
			<option value="Nyborg">Nyborg</option>
			<option value="Næstved">Næstved</option>
			<option value="Odder">Odder</option>
			<option value="Odense">Odense</option>
			<option value="Odsherred">Odsherred</option>
			<option value="Randers">Randers</option>
			<option value="Rebild">Rebild</option>
			<option value="Ringkøbing-Skjern">Ringkøbing-Skjern</option>
			<option value="Ringsted">Ringsted</option>
			<option value="Roskilde">Roskilde</option>
			<option value="Rudersdal">Rudersdal</option>
			<option value="Rødovre">Rødovre</option>
			<option value="Samsø">Samsø</option>
			<option value="Silkeborg">Silkeborg</option>
			<option value="Skanderborg">Skanderborg</option>
			<option value="Skive">Skive</option>
			<option value="Slagelse">Slagelse</option>
			<option value="Solrød">Solrød</option>
			<option value="Sorø">Sorø</option>
			<option value="Stevns">Stevns</option>
			<option value="Struer">Struer</option>
			<option value="Svendborg">Svendborg</option>
			<option value="Syddjurs">Syddjurs</option>
			<option value="Sønderborg">Sønderborg</option>
			<option value="Thisted">Thisted</option>
			<option value="Tårnby">Tårnby</option>
			<option value="Tønder">Tønder</option>
			<option value="Vallensbæk">Vallensbæk</option>
			<option value="Varde">Varde</option>
			<option value="Vejen">Vejen</option>
			<option value="Vejle">Vejle</option>
			<option value="Vesthimmerlands">Vesthimmerlands</option>
			<option value="Viborg">Viborg</option>
			<option value="Vordingborg">Vordingborg</option>
			<option value="Ærø">Ærø</option>
		</select>
	</div>
</div>

<div class='vis' id='vis-working'></div>





<script src="https://d3js.org/d3.v5.min.js"></script>


<script>

	function workingvis() {

		
		

		let data, datum, time;
		let level = "all",
			mode = 'count';


		
		

		
		let maindiv = document.getElementById("vis-working")
		let width = maindiv.offsetWidth - margin.left - margin.right,
			height = figureHeight - margin.top - margin.bottom;

		
		let x = d3.scaleTime().range([0, width]);
		let y = d3.scaleLinear().range([height, 0]);

		
		let xAxis = d3.axisBottom(x);
		let yAxis = d3.axisLeft(y).ticks(6);

		
		let valueline = d3.line()
			.x(function(d) { return x(d[0]); })
			.y(function(d) { return y(d[1]); });

		
		let svg = d3.select("#vis-working")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
						"translate(" + margin.left + "," + margin.top + ")");

		
		svg.append("text")
			.attr("x", width/2)
			.attr("y", -15)
			.style("text-anchor", "middle")
			.style("font-weight", 700)
			.text("Going out during working hours");

		
		svg.append("text")
			.attr("x", -60)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", 'toggleRelativeworking')
			.style("text-anchor", "left")
			.style("font-weight", 300)
			.style('cursor', 'pointer')
			.text("rel")
			.on('click', handleTextClickWorking);

		
		svg.append("text")
			.attr("x", -37)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", "toggleAbsworking")
			.style("text-anchor", "left")
			.style("font-weight", 700)
			.style('cursor', 'pointer')
			.text("abs")
			.on('click', handleTextClickWorking);

		
		
		d3.json("/data/night_day_difference.json").then(function(data_) {

			
			data = data_;

			
			time = data._meta.datetime.map(d => parseDate(d));
			let dt = d3.max(time);
			let d0 = parseDate(startDate);
			let n_days = (dt - d0 + 3.6e6) / 86.4e6
			let time_shown = d3.range(n_days+1).map(n => d0.addDays(n));

			
			let yrange = [-0.05, 0.3]
			x.domain(d3.extent(time_shown));
			y.domain(yrange);

			
			let idxwknd = d3.range(4, time_shown.length, 7);
			let dx = x(time[2]) - x(time[0]);
			let dy = y(yrange[0]) - y(yrange[1]);
			svg.selectAll('shade')
				.data(idxwknd)
				.enter().append("rect")
				.attr("class", "shade")
				.attr("x", d => {
					return d == 0 ? x(time_shown[d]) : x(time_shown[d]) - dx/4
				})
				.attr("y", d => y(yrange[1]))
				.attr("width", d => {
					if (d == 0 | d == time_shown.length - 2) {
						return dx * 3/4;
					} else if (d == time_shown.length - 1) {
						return dx * 1/4;
					} else {
						return dx;
					}
				})
				.attr("height", dy)
				.style('fill', '#ecf0f1')
				.style('fill-opacity', 1)

			
			svg.append('rect')
				.attr('x', x(time_shown[0]))
				.attr('y', y(yrange[1]))
				.attr('width', x(time[0]) - x(time_shown[0]))
				.attr('height', dy)
				.attr('fill', 'url(#lines)')
				.attr('stroke-width', 1.5)
				.attr('fill-opacity', 0.2)
			svg.append('text')
				.attr('x', 10)
				.attr('y', 20)
				.style("font-weight", 0)
				.style("font-size", "12px")
				.text('NO DATA')

			
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			
			for (let d of eventDates) {  
				svg.append('line')
					.attr('class', 'histEvent')
					.attr('id', d[2] + "working")
					.attr('x1', x(parseDate(d[0])))
					.attr('x2', x(parseDate(d[0])))
					.attr('y1', height)
					.attr('y2', height)
				svg.append('circle')
					.attr('class', 'histEventDot')
					.attr('cx', x(parseDate(d[0])))
					.attr('cy', height)
					.attr('r', 3)
					.on('mouseover', mouseover)
					.on('mousemove', () => {
						mousemoveHistEvent(d);
						d3.select("#" + d[2] + "working").attr('y2', 0)
					})
					.on('mouseout', () => {
						mouseout();
						d3.select("#" + d[2] + "working").attr('y2', height)
					})
			}

			
			svg.append('line')
				.attr('class', 'line')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 10)
				.attr('y2', 10)
			svg.append('circle')
				.attr('class', 'dot')
				.attr('cx', width+20)
				.attr('cy', 10)
				.attr('r', 2.5)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 10+4)
				.text('daily')
			svg.append('line')
				.attr('class', 'line-baseline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 30)
				.attr('y2', 30)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 30+4)
				.text('baseline')
			svg.append('line')
				.attr('class', 'trendline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 50)
				.attr('y2', 50)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 50+4)
				.text('7 day avg')
			
			visualize(data, level);
		})

		d3.select('#levelWorking')
			.on("change", () => {
				let dropdown = document.getElementById("levelWorking");
				level = dropdown.options[dropdown.selectedIndex].value;
				d3.selectAll("#dataWorking").remove();
				visualize(data, level);
			});

		
		
		function visualize(data, level) {

			if (mode == 'count') {
				yAxis = d3.axisLeft(y).tickFormat(v => v/1e3 + "k")
			} else if (mode == 'relative') {
				yAxis = d3.axisLeft(y).ticks(6, ".0%")
			}

			if (mode == 'count') {
				yrange = [0, d3.max([...data[level]['baseline'], ...data[level]['crisis']])*1.2]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataWorking")
					.call(yAxis);

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataWorking")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Number of people");

				
				datum = zip(time, data[level]['baseline']);
				datum = adjustBaseline(datum);
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-baseline')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot-baseline")
					.attr("id", "dataWorking")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 3.5)
					.on('mouseover', d => {
						mouseover(d);
					})
					.on('mousemove', d => {
						mousemoveDot(d);
					})
					.on("mouseout", d => {
						mouseout(d);
					});
				datum = zip(time, weekavg(data[level]['crisis']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				datum = zip(time, data[level]['crisis'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				datum = zip(time, data[level]['crisis'])
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataWorking")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', d => {
						mouseover(d);
					})
					.on('mousemove', d => {
						mousemoveDot(d);
					})
					.on("mouseout", d => {
						mouseout(d);
					});

			} else if (mode == 'relative') {
				yrange = [d3.min(data[level]['percent_change'])-0.1, d3.max(data[level]['percent_change'])+0.1]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataWorking")
					.call(yAxis);

				
				datum = zip([parseDate(startDate), ...time], d3.range(time.length+1).map(() => 0))
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-horizontal')
					.attr("id", "dataWorking")
					.attr('d', valueline)

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataWorking")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Deviation from baseline");

				
				datum = zip(time, weekavg(data[level]['percent_change']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				datum = zip(time, data[level]['percent_change'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataWorking")
					.attr('d', valueline)
				datum = zip(time, data[level]['percent_change'])
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataWorking")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);
			}
		}

		
		

		
		function mousemoveDot(d) {
			let tooltiptext;
			if (mode == 'relative') {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Deviation: <b>" + round(d[1]*100, 1e1) + "%</b>"
			} else {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Population: <b>" + round(d[1], 1e0) + "</b>"
			}

			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX) + "px")
				.style("top", (d3.event.pageY) + "px");
		}
		function handleTextClickWorking() {
			if (mode == 'count') {
				d3.select('#toggleRelativeworking')
					.style('font-weight', 700);
				d3.select('#toggleAbsworking')
					.style('font-weight', 300);
				mode = "relative";
			} else {
				d3.select('#toggleRelativeworking')
					.style('font-weight', 300);
				d3.select('#toggleAbsworking')
					.style('font-weight', 700);
				mode = "count";
			}
			d3.selectAll("#dataWorking").remove();
			visualize(data, level);
		}
		function update0() {
			d3.selectAll("#dataWorking").remove();
			level = 'all';
			visualize(data, level);
		}
		function update1() {
			d3.selectAll("#dataWorking").remove();
			level = 'within_kommune';
			visualize(data, level);
		}
		function update2() {
			d3.selectAll("#dataWorking").remove();
			level = 'within_region';
			visualize(data, level);
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2
		}
	}

	
	let instance_working = workingvis()

	
	function adjustBaseline(datum) {
		datumy = d3.range(7).map(() => []);
		datum.forEach((d, i) => {
		    datumy[i%7].push(d[1])
		})
		datumy = datumy.map(d => d3.mean(d))
		return datum.map((d, i) => [d[0], datumy[i%7]])
	}
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	function round(val, order) {
		return Math.round(val * order) / order;
	}

	Date.prototype.addDays = function(n) {
	    let date = new Date(this.valueOf());
	    date.setDate(date.getDate() + n);
	    return date;
	}
</script>
<p><strong>Observation 4:</strong> <em>People are spending less time away from home during weekdays</em>. This is an expected pattern (around -50%, toggle <strong>rel</strong> abs to inspect), and corroborates <em>Observation 3</em>.</p>
<p><strong>Observation 5:</strong> <em>People are more away from home on weekends</em>, which is a trend that seems to increase over time. One plausible explanation for this is that the weather in Denmark has been exceptionally good during April motivating people to spend more time outside. At the same time, the baseline is based on data from January and February, where people tend to stay inside because of cold weather. Even so, however, the large increase in the most recent weekends <em>[written: May 4]</em> shows that people are going out on weekends more.</p>
<p><strong>Observation 6:</strong> <em>Date of child-care reopening is a changepoint</em>. April 15 when daycare institutions, kindergardens and school for the youngest opened back up (at 50% capacity), the number of people leaving their home during working hours seems to rise above the trend seen previously in the lockdown. In the following weeks more people follow suit (though still around -35% reduction).</p>
<h3 id="local-population-deviation"><strong>Local population deviation</strong></h3>
<p>We saw in the visualization of the Population density maps that there are places which attract people during the lockdown and others that drive them away (observations 1 and 2). We begin, therefore, by quantifying population count changes over time at the municipality level.</p>
<p><em>Question: How many people are there a given municipality, compared to pre-lockdown?</em></p>
<p>We first plot daily population change for all municipalities in the same figure. The figure lets you toggle whether the y-axis displays change relative to the average population size of each municipality (<strong>rel</strong><span style="color:white">/</span>abs), or not, i.e. the absolute population deviation (rel<span style="color:white">/</span><strong>abs</strong>). You can also change the time interval to display results for.</p>




<style type="text/css">
	.line-changeall { 
		stroke: black;
		stroke-width: 1.5;
		opacity: 0.5;
		fill: none;
	}

	.line-legend-changeall { 
		stroke: black;
		stroke-width: 2;
		opacity: 0.5;
		fill: none;
	}

	input.changeall[type=radio] {
		position: absolute;
		visibility: hidden;
		display: none;
	}

	label.changeall {
		color: #222222;
		display: inline-block;
		font-size: 12px;
		font-weight: 500;
		padding: 0px 5px 0px 5px;
	}

	input.changeall[type=radio]:checked + label.changeall{
		color: #ffffff;
		background: #555555;
		cursor: pointer;
	}

	label.changeall + input.changeall[type=radio] + label.changeall {
		border-left: solid 1px #999999;
		cursor: pointer;
	}
</style>






<!DOCTYPE html>
<meta charset="utf-8">


<div class="flex">
	<div class="flex radio-group">
		<input class="changeall" onclick="instance_changeall.update0()" type="radio" id="option-zero-changeall" name="selector-changeall" checked>
		<label class="changeall" for="option-zero-changeall">All day</label>
		<input class="changeall" onclick="instance_changeall.update2()" type="radio" id="option-two-changeall" name="selector-changeall">
		<label class="changeall" for="option-two-changeall">10–18</label>
		<input class="changeall" onclick="instance_changeall.update3()" type="radio" id="option-three-changeall" name="selector-changeall">
		<label class="changeall" for="option-three-changeall">18–02</label>
	</div>
</div>
<div class='vis' id="vis-changeall"></div>






<script>

	function changeallvis() {

		
		

		let data, time;
		let timeframe = "allday",
			level = "none",
			mode = 'relative';


		
		
		

		
		let maindiv = document.getElementById("vis-changeall")
		let width = maindiv.offsetWidth - margin.left - margin.right,
			height = figureHeight - margin.top - margin.bottom;

		
		let x = d3.scaleTime().range([0, width]);
		let y = d3.scaleLinear().range([height, 0]);

		
		let xAxis = d3.axisBottom(x);
		let yAxis = d3.axisLeft(y);

		
		let valueline = d3.line()
			.x(function(d) { return x(d[0]); })
			.y(function(d) { return y(d[1]); });

		
		let svg = d3.select("#vis-changeall")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
						"translate(" + margin.left + "," + margin.top + ")");

		
		svg.append("text")
			.attr("x", width/2)
			.attr("y", -15)
			.style("text-anchor", "middle")
			.style("font-weight", 700)
			.text("Change in population size");

		
		svg.append("text")
			.attr("x", -60)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", 'toggleRelativechangeall')
			.style("text-anchor", "left")
			.style("font-weight", 700)
			.style('cursor', 'pointer')
			.text("rel")
			.on('click', handleTextClickChangeAll)
		
		svg.append("text")
			.attr("x", -37)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", "toggleAbschangeall")
			.style("text-anchor", "left")
			.style("font-weight", 300)
			.style('cursor', 'pointer')
			.text("abs")
			.on('click', handleTextClickChangeAll)


		
		
		d3.json("/data/change.json").then(function(data_) {

			
			data = data_;

			
			time = data._meta._meta.datetime.map(d => parseDate(d));
			let dt = d3.max(time);
			let d0 = parseDate(startDate);
			let n_days = (dt - d0 + 3.6e6) / 86.4e6
			let time_shown = d3.range(n_days+1).map(n => d0.addDays(n));

			
			let yrange = [-0.3, 0.8]
			x.domain(d3.extent(time_shown));
			y.domain(yrange);

			
			let idxwknd = d3.range(4, time_shown.length, 7);
			let dx = x(time[2]) - x(time[0]);
			let dy = y(yrange[0]) - y(yrange[1]);

			svg.selectAll('shade')
				.data(idxwknd).enter().append("rect")
				.attr("class", "shade")
				.attr("x", d => {
					return d == 0 ? x(time_shown[d]) : x(time_shown[d]) - dx/4
				})
				.attr("y", d => y(yrange[1]))
				.attr("width", d => {
					if (d == 0 | d == time_shown.length - 2) {
						return dx * 3/4;
					} else if (d == time_shown.length - 1) {
						return dx * 1/4;
					} else {
						return dx;
					}
				})
				.attr("height", dy)
				.style('fill', '#ecf0f1')
				.style('fill-opacity', 1)

			
			svg.append('rect')
				.attr('x', x(time_shown[0]))
				.attr('y', y(yrange[1]))
				.attr('width', x(time[0]) - x(time_shown[0]))
				.attr('height', dy)
				.attr('fill', 'url(#lines)')
				.attr('stroke-width', 1.5)
				.attr('fill-opacity', 0.2)
			svg.append('text')
				.attr('x', 10)
				.attr('y', 20)
				.style("font-weight", 0)
				.style("font-size", "12px")
				.text('NO DATA')

			
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			
			for (let d of eventDates) {  
				svg.append('line')
					.attr('class', 'histEvent')
					.attr('id', d[2] + "changeall")
					.attr('x1', x(parseDate(d[0])))
					.attr('x2', x(parseDate(d[0])))
					.attr('y1', height)
					.attr('y2', height)
				svg.append('circle')
					.attr('class', 'histEventDot')
					.attr('cx', x(parseDate(d[0])))
					.attr('cy', height)
					.attr('r', 3)
					.on('mouseover', mouseover)
					.on('mousemove', () => {
						mousemoveHistEvent(d);
						d3.select("#" + d[2] + "changeall").attr('y2', 0)
					})
					.on('mouseout', () => {
						mouseout();
						d3.select("#" + d[2] + "changeall").attr('y2', height)
					})
			}

			
			svg.append('line')
				.attr('class', 'line-legend-changeall')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 10)
				.attr('y2', 10)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 10+4)
				.text('daily')
			
			visualize(data, timeframe, level);
		})
		
		d3.select('#placeChangeAll')
			.on("change", () => {
				let dropdown = document.getElementById("placeChangeAll");
				level = dropdown.options[dropdown.selectedIndex].value;
				d3.selectAll(".line-changeall").remove();
				d3.selectAll("#dataChangeAll").remove();
				visualize(data, timeframe, level);
			});

		
		

		function visualize(data, timeframe, level) {

			if (mode == 'count') {
				yAxis = d3.axisLeft(y).tickFormat(v => v/1e3 + "k")
			} else if (mode == 'relative') {
				yAxis = d3.axisLeft(y).ticks(6, ".0%")
			}

			if (mode == 'count') {
				yrange = [-1.2e5, 4e4]
				y.domain(yrange);
				for (let place_ of Object.keys(data[timeframe])) {
					let datum = zip(time, d3.range(time.length).map(i => {
						return data[timeframe][place_]['crisis'][i] - data[timeframe][place_]['baseline'][i]
					}))
					svg.append("path")
						.datum(datum)
						.attr('class', 'line-changeall')
						.attr("id", place_)
						.attr('d', valueline)
						.on('mouseover', d => {
							mouseover();
							d3.selectAll('.line-changeall')
								.style('opacity', 0.01);
							d3.select('#'+place_)
								.style('opacity', 1);
						})
						.on('mousemove', () => mousemove(place_))
						.on('mouseout', d => {
							mouseout();
							d3.selectAll('.line-changeall')
								.style('opacity', 0.7);
						})
				}

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataChangeAll")
					.call(yAxis);

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataChangeAll")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Ppopulation change");

			} else if (mode == 'relative') {
				yrange = [-0.3, 1]
				y.domain(yrange);
				for (let place_ of Object.keys(data[timeframe])) {
					let datum = zip(time, data[timeframe][place_]['percent_change'])
					svg.append("path")
						.datum(datum)
						.attr('class', 'line-changeall')
						.attr("id", place_)
						.attr('d', valueline)
						.on('mouseover', d => {
							mouseover();
							d3.selectAll('.line-changeall')
								.style('opacity', 0.1);
							d3.select('#'+place_)
								.style('opacity', 1);
						})
						.on('mousemove', () => mousemove(place_))
						.on('mouseout', d => {
							mouseout();
							d3.selectAll('.line-changeall')
								.style('opacity', 0.7);
						})
				}

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataChangeAll")
					.call(yAxis);

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataChangeAll")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Percentage population change");
			}

			
			datum = zip([parseDate(startDate), ...time], d3.range(time.length+1).map(() => 0))
			svg.append("path")
				.datum(datum)
				.attr('class', 'line-horizontal')
				.attr("id", "dataChangeAll")
				.attr('d', valueline)
		}

		
		function mousemove(level_) {
			tooltip
				.html(level_)
				.style("left", (d3.event.pageX ) + "px")
				.style("top", (d3.event.pageY) + "px");
		}

		function handleTextClickChangeAll() {
			if (mode == 'count') {
				d3.select('#toggleRelativechangeall')
					.style('font-weight', 700);
				d3.select('#toggleAbschangeall')
					.style('font-weight', 300);
				mode = "relative";
			} else {
				d3.select('#toggleRelativechangeall')
					.style('font-weight', 300);
				d3.select('#toggleAbschangeall')
					.style('font-weight', 700);
				mode = "count";
			}
			d3.selectAll(".line-changeall").remove();
			d3.selectAll("#dataChangeAll").remove();
			visualize(data, timeframe, level)
		}

		function update0() {
			d3.selectAll(".line-changeall").remove();
			d3.selectAll("#dataChangeAll").remove();
			timeframe = 'allday';
			visualize(data, timeframe, level)
		}
		function update1() {
			d3.selectAll(".line-changeall").remove();
			d3.selectAll("#dataChangeAll").remove();
			timeframe = '00';
			visualize(data, timeframe, level)
		}
		function update2() {
			d3.selectAll(".line-changeall").remove();
			d3.selectAll("#dataChangeAll").remove();
			timeframe = '08';
			visualize(data, timeframe, level)
		}
		function update3() {
			d3.selectAll(".line-changeall").remove();
			d3.selectAll("#dataChangeAll").remove();
			timeframe = '16';
			visualize(data, timeframe, level)
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2,
			update3: update3,
		}
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	let instance_changeall = changeallvis()
</script>












<p>We also plot each municipality individually letting you select which one to display using the dropdown. Here toggling &lsquo;rel<span style="color:white">/</span><strong>abs</strong>&rsquo; displays population size on the y-axis. For example, for Copenhagen (København) we see that the baseline population size is around 600k (the public count for 2017 is 602.581; source UN) whereas the lockdown population size is around 540k, which yields a relative change of around -10%.</p>


<style type="text/css">
	input.change[type=radio] {
		position: absolute;
		visibility: hidden;
		display: none;
	}

	label.change {
		color: #222222;
		display: inline-block;
		font-size: 12px;
		font-weight: 500;
		padding: 0px 5px 0px 5px;
	}

	input.change[type=radio]:checked + label.change{
		color: #ffffff;
		background: #555555;
		cursor: pointer;
	}

	label.change + input.change[type=radio] + label.change {
		border-left: solid 1px #999999;
		cursor: pointer;
	}
</style>



<!DOCTYPE html>
<meta charset="utf-8">


<div class="flex">
	<div class="flex radio-group">
		<input class="change" onclick="instance_change.update0()" type="radio" id="option-zero-change" name="selector-change" checked>
		<label class="change" for="option-zero-change">All day</label>
		<input class="change" onclick="instance_change.update2()" type="radio" id="option-two-change" name="selector-change">
		<label class="change" for="option-two-change">10–18</label>
		<input class="change" onclick="instance_change.update3()" type="radio" id="option-three-change" name="selector-change">
		<label class="change" for="option-three-change">18–02</label>
	</div>
	<div class="select-place">
		<select id="placeChange">
			<option value="Aabenraa">Aabenraa</option>
			<option value="Aalborg">Aalborg</option>
			<option value="Aarhus">Aarhus</option>
			<option value="Albertslund">Albertslund</option>
			<option value="Allerød">Allerød</option>
			<option value="Assens">Assens</option>
			<option value="Ballerup">Ballerup</option>
			<option value="Billund">Billund</option>
			<option value="Brøndby">Brøndby</option>
			<option value="Brønderslev">Brønderslev</option>
			<option value="Dragør">Dragør</option>
			<option value="Egedal">Egedal</option>
			<option value="Esbjerg">Esbjerg</option>
			<option value="Faaborg-Midtfyn">Faaborg-Midtfyn</option>
			<option value="Fanø">Fanø</option>
			<option value="Favrskov">Favrskov</option>
			<option value="Faxe">Faxe</option>
			<option value="Fredensborg">Fredensborg</option>
			<option value="Fredericia">Fredericia</option>
			<option value="Frederiksberg">Frederiksberg</option>
			<option value="Frederikshavn">Frederikshavn</option>
			<option value="Frederikssund">Frederikssund</option>
			<option value="Furesø">Furesø</option>
			<option value="Gentofte">Gentofte</option>
			<option value="Gladsaxe">Gladsaxe</option>
			<option value="Glostrup">Glostrup</option>
			<option value="Greve">Greve</option>
			<option value="Gribskov">Gribskov</option>
			<option value="Guldborgsund">Guldborgsund</option>
			<option value="Haderslev">Haderslev</option>
			<option value="Halsnæs">Halsnæs</option>
			<option value="Hedensted">Hedensted</option>
			<option value="Helsingør">Helsingør</option>
			<option value="Herlev">Herlev</option>
			<option value="Herning">Herning</option>
			<option value="Hillerød">Hillerød</option>
			<option value="Hjørring">Hjørring</option>
			<option value="Holbæk">Holbæk</option>
			<option value="Holstebro">Holstebro</option>
			<option value="Horsens">Horsens</option>
			<option value="Hvidovre">Hvidovre</option>
			<option value="Høje-Taastrup">Høje-Taastrup</option>
			<option value="Hørsholm">Hørsholm</option>
			<option value="Ikast-Brande">Ikast-Brande</option>
			<option value="Ishøj">Ishøj</option>
			<option value="Jammerbugt">Jammerbugt</option>
			<option value="Kalundborg">Kalundborg</option>
			<option value="Kerteminde">Kerteminde</option>
			<option value="Kolding">Kolding</option>
			<option value="København" selected="selected">København</option>
			<option value="Køge">Køge</option>
			<option value="Langeland">Langeland</option>
			<option value="Lejre">Lejre</option>
			<option value="Lemvig">Lemvig</option>
			<option value="Lolland">Lolland</option>
			<option value="Lyngby-Taarbæk">Lyngby-Taarbæk</option>
			<option value="Læsø">Læsø</option>
			<option value="Mariagerfjord">Mariagerfjord</option>
			<option value="Middelfart">Middelfart</option>
			<option value="Morsø">Morsø</option>
			<option value="Norddjurs">Norddjurs</option>
			<option value="Nordfyns">Nordfyns</option>
			<option value="Nyborg">Nyborg</option>
			<option value="Næstved">Næstved</option>
			<option value="Odder">Odder</option>
			<option value="Odense">Odense</option>
			<option value="Odsherred">Odsherred</option>
			<option value="Randers">Randers</option>
			<option value="Rebild">Rebild</option>
			<option value="Ringkøbing-Skjern">Ringkøbing-Skjern</option>
			<option value="Ringsted">Ringsted</option>
			<option value="Roskilde">Roskilde</option>
			<option value="Rudersdal">Rudersdal</option>
			<option value="Rødovre">Rødovre</option>
			<option value="Samsø">Samsø</option>
			<option value="Silkeborg">Silkeborg</option>
			<option value="Skanderborg">Skanderborg</option>
			<option value="Skive">Skive</option>
			<option value="Slagelse">Slagelse</option>
			<option value="Solrød">Solrød</option>
			<option value="Sorø">Sorø</option>
			<option value="Stevns">Stevns</option>
			<option value="Struer">Struer</option>
			<option value="Svendborg">Svendborg</option>
			<option value="Syddjurs">Syddjurs</option>
			<option value="Sønderborg">Sønderborg</option>
			<option value="Thisted">Thisted</option>
			<option value="Tårnby">Tårnby</option>
			<option value="Tønder">Tønder</option>
			<option value="Vallensbæk">Vallensbæk</option>
			<option value="Varde">Varde</option>
			<option value="Vejen">Vejen</option>
			<option value="Vejle">Vejle</option>
			<option value="Vesthimmerlands">Vesthimmerlands</option>
			<option value="Viborg">Viborg</option>
			<option value="Vordingborg">Vordingborg</option>
			<option value="Ærø">Ærø</option>
		</select>
	</div>
</div>
<div class='vis' id='vis-change'></div>





<script src="https://d3js.org/d3.v5.min.js"></script>


<script>

	function changevis() {

		
		

		let data, time;
		let timeframe = "allday",
			level = "København",
			mode = 'relative';


		
		
		

		
		let maindiv = document.getElementById("vis-change")
		let width = maindiv.offsetWidth - margin.left - margin.right,
			height = figureHeight - margin.top - margin.bottom;

		
		let x = d3.scaleTime().range([0, width]);
		let y = d3.scaleLinear().range([height, 0]);

		
		let xAxis = d3.axisBottom(x);
		let yAxis = d3.axisLeft(y);

		
		let valueline = d3.line()
			.x(function(d) { return x(d[0]); })
			.y(function(d) { return y(d[1]); });

		
		let svg = d3.select("#vis-change")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
						"translate(" + margin.left + "," + margin.top + ")");

		
		svg.append("text")
			.attr("x", width/2)
			.attr("y", -15)
			.style("text-anchor", "middle")
			.style("font-weight", 700)
			.text("Change in population size (single municipality)");

		
		svg.append("text")
			.attr("x", -60)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", 'toggleRelativechange')
			.style("text-anchor", "left")
			.style("font-weight", 700)
			.style('cursor', 'pointer')
			.text("rel")
			.on('click', handleTextClickChange)
		
		svg.append("text")
			.attr("x", -37)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", "toggleAbschange")
			.style("text-anchor", "left")
			.style("font-weight", 300)
			.style('cursor', 'pointer')
			.text("abs")
			.on('click', handleTextClickChange)


		
		
		d3.json("/data/change.json").then(function(data_) {

			
			data = data_;

			
			time = data._meta._meta.datetime.map(d => parseDate(d));
			let dt = d3.max(time);
			let d0 = parseDate(startDate);
			let n_days = (dt - d0 + 3.6e6) / 86.4e6
			let time_shown = d3.range(n_days+1).map(n => d0.addDays(n));

			
			let yrange = [-0.3, 0.8]
			x.domain(d3.extent(time_shown));
			y.domain(yrange);

			
			let idxwknd = d3.range(4, time_shown.length, 7);
			let dx = x(time[2]) - x(time[0]);
			let dy = y(yrange[0]) - y(yrange[1]);

			svg.selectAll('shade')
				.data(idxwknd).enter().append("rect")
				.attr("class", "shade")
				.attr("x", d => {
					return d == 0 ? x(time_shown[d]) : x(time_shown[d]) - dx/4
				})
				.attr("y", d => y(yrange[1]))
				.attr("width", d => {
					if (d == 0 | d == time_shown.length - 2) {
						return dx * 3/4;
					} else if (d == time_shown.length - 1) {
						return dx * 1/4;
					} else {
						return dx;
					}
				})
				.attr("height", dy)
				.style('fill', '#ecf0f1')
				.style('fill-opacity', 1)

			
			svg.append('rect')
				.attr('x', x(time_shown[0]))
				.attr('y', y(yrange[1]))
				.attr('width', x(time[0]) - x(time_shown[0]))
				.attr('height', dy)
				.attr('fill', 'url(#lines)')
				.attr('stroke-width', 1.5)
				.attr('fill-opacity', 0.2)
			svg.append('text')
				.attr('x', 10)
				.attr('y', 20)
				.style("font-weight", 0)
				.style("font-size", "12px")
				.text('NO DATA')

			
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			
			for (let d of eventDates) {  
				svg.append('line')
					.attr('class', 'histEvent')
					.attr('id', d[2] + "change")
					.attr('x1', x(parseDate(d[0])))
					.attr('x2', x(parseDate(d[0])))
					.attr('y1', height)
					.attr('y2', height)
				svg.append('circle')
					.attr('class', 'histEventDot')
					.attr('cx', x(parseDate(d[0])))
					.attr('cy', height)
					.attr('r', 3)
					.on('mouseover', mouseover)
					.on('mousemove', () => {
						mousemoveHistEvent(d);
						d3.select("#" + d[2] + "change").attr('y2', 0)
					})
					.on('mouseout', () => {
						mouseout();
						d3.select("#" + d[2] + "change").attr('y2', height)
					})
			}

			
			svg.append('line')
				.attr('class', 'line')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 10)
				.attr('y2', 10)
			svg.append('circle')
				.attr('class', 'dot')
				.attr('cx', width+20)
				.attr('cy', 10)
				.attr('r', 2.5)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 10+4)
				.text('daily')
			svg.append('line')
				.attr('class', 'line-baseline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 30)
				.attr('y2', 30)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 30+4)
				.text('baseline')
			svg.append('line')
				.attr('class', 'trendline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 50)
				.attr('y2', 50)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 50+4)
				.text('7 day avg')

			visualize(data, timeframe, level);
		})
		
		d3.select('#placeChange')
			.on("change", () => {
				let dropdown = document.getElementById("placeChange");
				level = dropdown.options[dropdown.selectedIndex].value;
				d3.selectAll("#dataChange").remove();
				visualize(data, timeframe, level);
			});

		
		

		function visualize(data, timeframe, level) {

			if (mode == 'count') {
				yAxis = d3.axisLeft(y).tickFormat(v => v/1e3 + "k")
			} else if (mode == 'relative') {
				yAxis = d3.axisLeft(y).ticks(6, ".0%")
			}

			if (mode == 'count') {
				yrange = [0, d3.max([...data[timeframe][level]['baseline'], ...data[timeframe][level]['crisis']])*1.2]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataChange")
					.call(yAxis);

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataChange")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Population size");

				
				datum = zip(time, data[timeframe][level]['baseline']);
				datum = adjustBaseline(datum);
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-baseline')
					.attr("id", "dataChange")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot-baseline")
					.attr("id", "dataChange")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 3.5)
					.on('mouseover', d => {
						mouseover(d);
					})
					.on('mousemove', d => {
						mousemoveDot(d);
					})
					.on("mouseout", d => {
						mouseout(d);
					});
				datum = zip(time, weekavg(data[timeframe][level]['crisis']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataChange")
					.attr('d', valueline)
				datum = zip(time, data[timeframe][level]['crisis'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataChange")
					.attr('d', valueline)
				datum = zip(time, data[timeframe][level]['crisis'])
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataChange")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', d => {
						mouseover(d);
					})
					.on('mousemove', d => {
						mousemoveDot(d);
					})
					.on("mouseout", d => {
						mouseout(d);
					});

			} else if (mode == 'relative') {
				yrange = [d3.min(data[timeframe][level]['percent_change'])-0.1, d3.max(data[timeframe][level]['percent_change'])+0.1]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataChange")
					.call(yAxis);

				
				datum = zip([parseDate(startDate), ...time], d3.range(time.length+1).map(() => 0))
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-horizontal')
					.attr("id", "dataChange")
					.attr('d', valueline)

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataChange")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Deviation from baseline");

				
				datum = zip(time, weekavg(data[timeframe][level]['percent_change']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataChange")
					.attr('d', valueline)
				datum = zip(time, data[timeframe][level]['percent_change'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataChange")
					.attr('d', valueline)
				datum = zip(time, data[timeframe][level]['percent_change'])
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataChange")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);
			}
		}

		
		function mousemoveDot(d) {
			let tooltiptext;
			if (mode == 'relative') {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Deviation: <b>" + Math.round(d[1]*100*1e1)/1e1 + "%</b>"
			} else {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Deviation: <b>" + Math.round(d[1]) + "</b>"
			}
			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX) + "px")
				.style("top", (d3.event.pageY) + "px");
		}

		function handleTextClickChange() {
			if (mode == 'count') {
				d3.select('#toggleRelativechange')
					.style('font-weight', 700);
				d3.select('#toggleAbschange')
					.style('font-weight', 300);
				mode = "relative";
			} else {
				d3.select('#toggleRelativechange')
					.style('font-weight', 300);
				d3.select('#toggleAbschange')
					.style('font-weight', 700);
				mode = "count";
			}
			d3.selectAll("#dataChange").remove();
			visualize(data, timeframe, level)
		}

		function update0() {
			d3.selectAll("#dataChange").remove();
			timeframe = 'allday';
			visualize(data, timeframe, level)
		}
		function update1() {
			d3.selectAll("#dataChange").remove();
			timeframe = '00';
			visualize(data, timeframe, level)
		}
		function update2() {
			d3.selectAll("#dataChange").remove();
			timeframe = '08';
			visualize(data, timeframe, level)
		}
		function update3() {
			d3.selectAll("#dataChange").remove();
			timeframe = '16';
			visualize(data, timeframe, level)
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2,
			update3: update3,
		}
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	let instance_change = changevis()
</script>












<p><strong>Observation 7:</strong> <em>Major country-wide population changes over Easter.</em> Over Easter and in particularly Thursday which was a national holiday, we observe the largest fluctuations in population size. Municipalities which primarily contain urban and large suburban areas see a massive decline in population. The municipalities with the largest <span style="color:#c0392b">relative population decrease</span> <strong>on Thursday April 9</strong> are:</p>
<ul>
<li>Frederiksberg (-16.6%, -17.6k)</li>
<li>København (-14.7%, -91.4k)</li>
<li>Tårnby (-12.1%, -8.0k)</li>
<li>Lyngby-Taarbæk (-12.0%, -5.3k)</li>
<li>Aarhus (-11.2%, -40.0k).</li>
</ul>
<p>Reversely, in municipalities which contain large portions of rural space there is an increase in population size on this date. Municipalities with largest <span style="color:#009432">relative increase</span> are:</p>
<ul>
<li>Fanø (81.1%, 2.6k)</li>
<li>Odsherred (62%, 20.0k)</li>
<li>Gribskov (48.4%, 18.9k)</li>
<li>Læsø (43.4%, 227)</li>
<li>Halsnæs (39.2%, 12.4k).</li>
</ul>
<p>While these changes level out after Easter, the above ranking more or less holds. For example, Gribskov municipality typically contains on average around 20% more people than usual (~15% during afternoon/night and ~30% during working hours). To what extent this occurs because people move into their summer houses, temporarily move in with relatives, or other is unclear from this analysis, but it is likely a mixture of different behaviors.</p>
<p>Overall it hints towards a population that is less concentrated in the cities and <em>more evenly spread out</em> across the country. In the section <em>Spread out population</em> we quantify this effect.</p>
<p><strong>Observation 8:</strong> <em>People are slowly returning to the cities</em>. On April 6 we made <em>Observation 1</em> that people were leaving the cities. Now <em>[written: May 4]</em> we observe that populations are slowly returning to the urban areas.</p>
<h3 id="assessing-relocation"><strong>Assessing relocation</strong></h3>
<p>Any <span style="color:#c0392b">positive</span> or <span style="color:#009432">negative</span> deviation observed in tiles means someone is not where they usually are. By averaging the total amount of positive and negative deviation we can assess the share of people that—relative to the given timeframe—<em>have relocated</em>.</p>
<p><em>Question: How many people are not in their usual place?</em></p>


<style type="text/css">
	input.diff[type=radio] {
		position: absolute;
		visibility: hidden;
		display: none;
	}

	label.diff {
		color: #222222;
		display: inline-block;
		font-size: 12px;
		font-weight: 500;
		padding: 0px 5px 0px 5px;
	}

	input.diff[type=radio]:checked + label.diff{
		color: #ffffff;
		background: #555555;
		cursor: pointer;
	}

	label.diff + input.diff[type=radio] + label.diff {
		border-left: solid 1px #999999;
		cursor: pointer;
	}
</style>



<!DOCTYPE html>
<meta charset="utf-8">


<div class="flex">
	<div class="flex radio-group">
		<input class="diff" onclick="instance_diff.update0()" type="radio" id="option-zero-diff" name="selector-diff" checked>
		<label class="diff" for="option-zero-diff">All day</label>
		<input class="diff" onclick="instance_diff.update2()" type="radio" id="option-two-diff" name="selector-diff">
		<label class="diff" for="option-two-diff">10–18</label>
		<input class="diff" onclick="instance_diff.update3()" type="radio" id="option-three-diff" name="selector-diff">
		<label class="diff" for="option-three-diff">18–02</label>
	</div>
	<div class="select-place">
		<select id="placeDiff">
			<option value="country" selected="selected">Within country</option>
			<option value="Region Hovedstaden">Within Hovedstaden</option>
			<option value="Region Midtjylland">Within Midtjylland</option>
			<option value="Region Nordjylland">Within Nordjylland</option>
			<option value="Region Sjælland">Within Sjælland</option>
			<option value="Region Syddanmark">Within Syddanmark</option>
		</select>
	</div>
</div>
<div class='vis' id='vis-diff'></div>





<script src="https://d3js.org/d3.v5.min.js"></script>


<script>

	function diffvis() {

		
		

		let data, time;
		let timeframe = "allday",
			place = "country";


		
		
		

		
		let maindiv = document.getElementById("vis-diff")
		let width = maindiv.offsetWidth - margin.left - margin.right,
			height = figureHeight - margin.top - margin.bottom;

		
		let x = d3.scaleTime().range([0, width]);
		let y = d3.scaleLinear().range([height, 0]);

		
		let formatPercent = d3.format(".0%");
		let xAxis = d3.axisBottom(x);
		let yAxis = d3.axisLeft(y).tickFormat(formatPercent).ticks(6, ".0%");

		
		let valueline = d3.line()
			.x(function(d) { return x(d[0]); })
			.y(function(d) { return y(d[1]); });

		
		let svg = d3.select("#vis-diff")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
						"translate(" + margin.left + "," + margin.top + ")");

		
		svg.append("text")
			.attr("x", width/2)
			.attr("y", -15)
			.style("text-anchor", "middle")
			.style("font-weight", 700)
			.text("Share of population relocated");

		
		svg.append("text")
			.attr("transform", "rotate(-90)")
			.attr("y", -40)
			.attr("x", -height / 2)
			.style("text-anchor", "middle")
			.style("font-weight", 500)
			.text("Share of population");

		
		
		d3.json("/data/difference.json").then(function(data_) {

			
			data = data_;

			
			time = data._meta.datetime.map(d => parseDate(d));
			let dt = d3.max(time);
			let d0 = parseDate(startDate);
			let n_days = (dt - d0 + 3.6e6) / 86.4e6
			let time_shown = d3.range(n_days+1).map(n => d0.addDays(n));

			
			let yrange = [0, 0.13]
			x.domain(d3.extent(time_shown));
			y.domain(yrange);

			
			let idxwknd = d3.range(4, time_shown.length, 7);
			let dx = x(time[2]) - x(time[0]);
			let dy = y(yrange[0]) - y(yrange[1]);

			svg.selectAll('shade')
				.data(idxwknd).enter().append("rect")
				.attr("class", "shade")
				.attr("x", d => {
					return d == 0 ? x(time_shown[d]) : x(time_shown[d]) - dx/4
				})
				.attr("y", d => y(yrange[1]))
				.attr("width", d => {
					if (d == 0 | d == time_shown.length - 2) {
						return dx * 3/4;
					} else if (d == time_shown.length - 1) {
						return dx * 1/4;
					} else {
						return dx;
					}
				})
				.attr("height", dy)
				.style('fill', '#ecf0f1')
				.style('fill-opacity', 1)

			
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			
			svg.append('rect')
				.attr('x', x(time_shown[0]))
				.attr('y', y(yrange[1]))
				.attr('width', x(time[0]) - x(time_shown[0]))
				.attr('height', dy)
				.attr('fill', 'url(#lines)')
				.attr('stroke-width', 1.5)
				.attr('fill-opacity', 0.2)
			svg.append('text')
				.attr('x', 10)
				.attr('y', 20)
				.style("font-weight", 0)
				.style("font-size", "12px")
				.text('NO DATA')

			
			for (let d of eventDates) {  
				svg.append('line')
					.attr('class', 'histEvent')
					.attr('id', d[2] + "diff")
					.attr('x1', x(parseDate(d[0])))
					.attr('x2', x(parseDate(d[0])))
					.attr('y1', height)
					.attr('y2', height)
				svg.append('circle')
					.attr('class', 'histEventDot')
					.attr('cx', x(parseDate(d[0])))
					.attr('cy', height)
					.attr('r', 3)
					.on('mouseover', mouseover)
					.on('mousemove', () => {
						mousemoveHistEvent(d);
						d3.select("#" + d[2] + "diff").attr('y2', 0)
					})
					.on('mouseout', () => {
						mouseout();
						d3.select("#" + d[2] + "diff").attr('y2', height)
					})
			}

			
			svg.append('line')
				.attr('class', 'line')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 10)
				.attr('y2', 10)
			svg.append('circle')
				.attr('class', 'dot')
				.attr('cx', width+20)
				.attr('cy', 10)
				.attr('r', 2.5)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 10+4)
				.text('daily')
			svg.append('line')
				.attr('class', 'line-baseline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 30)
				.attr('y2', 30)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 30+4)
				.text('baseline')
			svg.append('line')
				.attr('class', 'trendline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 50)
				.attr('y2', 50)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 50+4)
				.text('7 day avg')
			
			visualize(data, timeframe, place);
		})
		
		d3.select('#placeDiff')
			.on("change", () => {
				let dropdown = document.getElementById("placeDiff");
				place = dropdown.options[dropdown.selectedIndex].value;
				d3.selectAll("#dataDiff").remove();
				visualize(data, timeframe, place);
			});

		
		

		function visualize(data, timeframe, place) {

			
			svg.append("g")
				.attr("class", "y axis")
				.attr("id", "dataDiff")
				.call(yAxis);

			
			let datum = zip(time, weekavg(data[timeframe][place]))
			svg.append("path")
				.datum(datum)
				.attr('class', 'trendline')
				.attr("id", "dataDiff")
				.attr('d', valueline)
			datum = zip(time, data[timeframe][place])
			svg.append("path")
				.datum(datum)
				.attr('class', 'line')
				.attr("id", "dataDiff")
				.attr('d', valueline)
			svg.selectAll("dot")
				.data(datum)
				.enter().append("circle")
				.attr("class", "dot")
				.attr("id", "dataDiff")
				.attr("cx", d => x(d[0]))
				.attr("cy", d => y(d[1]))
				.attr("r", 2.5)
				.on('mouseover', mouseover)
				.on('mousemove', mousemoveDot)
				.on("mouseout", mouseout);
		}

		
		function mousemoveDot(d) {
			tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Share: <b>" + round(d[1]*100, 1e1) + "%</b>"
			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX) + "px")
				.style("top", (d3.event.pageY) + "px");
		}
		function update0() {
			d3.selectAll("#dataDiff").remove();
			timeframe = 'allday';
			visualize(data, timeframe, place)
		}
		function update1() {
			d3.selectAll("#dataDiff").remove();
			timeframe = '00';
			visualize(data, timeframe, place)
		}
		function update2() {
			d3.selectAll("#dataDiff").remove();
			timeframe = '08';
			visualize(data, timeframe, place)
		}
		function update3() {
			d3.selectAll("#dataDiff").remove();
			timeframe = '16';
			visualize(data, timeframe, place)
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2,
			update3: update3,
		}
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	let instance_diff = diffvis()
</script>
<p><strong>Observation 9:</strong> <em>2–4% of the population has temporarily moved away from their home.</em> The relocation we observe during afternoon and night (select 18–02) equates to the number of people that are not at home at night. Relocation peaks at 5% on Friday of Easter. We expect this to decrease to 0% when society has fully reopened, but at the current time <em>[written: May 4]</em> there does not appear to be a decrease compared to the earliest recorded week of lockdown.</p>
<p><strong>Observation 10:</strong> <em>5-7% are displaced during working hours</em>. Selecting the time window 10–18 we observe that people have relocated work to other places—like home—and are, therefore, not in their usual place–their workplace. For the reason mentioned under <em>Leaving home during the day</em> we can only take the values on the y-axis as a lower bound. But we do observe that a decreasing proportion of the population keeps away from work.</p>
<h3 id="spread-out-population"><strong>Spread out population</strong></h3>
<p>The <a href="https://en.wikipedia.org/wiki/Gini_coefficient">Gini Index</a> measures how <em>unevenly distributed</em> (or <em>concentrated</em>) a distribution is and can, therefore, inform us about trends in how the population spreads out across the country. As we can see from the giant peaks of cities in the Population density maps visualization (see <em>Visualizing population distribution</em>), the population is usually very unevenly distributed. We observe in the same map visualization that people spread out during the lockdown, distributing themselves more evenly throughout the country.</p>
<p>The Gini Index ranges from zero to one. If the population spreads out perfectly such that every tile contains the same number of people, the Gini Index will be zero. If all of Denmark concentrates in a single tile it will be one. In the figure below you can select different timeframes for different parts of the country.</p>


<style type="text/css">
	input.gini[type=radio] {
		position: absolute;
		visibility: hidden;
		display: none;
	}

	label.gini {
		color: #222222;
		display: inline-block;
		font-size: 12px;
		font-weight: 500;
		padding: 0px 5px 0px 5px;
	}

	input.gini[type=radio]:checked + label.gini{
		color: #ffffff;
		background: #555555;
		cursor: pointer;
	}

	label.gini + input.gini[type=radio] + label.gini {
		border-left: solid 1px #999999;
		cursor: pointer;
	}
</style>



<!DOCTYPE html>
<meta charset="utf-8">


<div class="flex">
	<div class="flex radio-group">
		<input class="gini" onclick="instance_gini.update0()" type="radio" id="option-zero-gini" name="selector-gini" checked>
		<label class="gini" for="option-zero-gini">All day</label>
		<input class="gini" onclick="instance_gini.update2()" type="radio" id="option-two-gini" name="selector-gini">
		<label class="gini" for="option-two-gini">10–18</label>
		<input class="gini" onclick="instance_gini.update3()" type="radio" id="option-three-gini" name="selector-gini">
		<label class="gini" for="option-three-gini">18–02</label>
	</div>
	<div class="select-place">
		<select id="placeGini">
			<option value="country" selected="selected">Within country</option>
			<option value="Region Hovedstaden">Within Hovedstaden</option>
			<option value="Region Midtjylland">Within Midtjylland</option>
			<option value="Region Nordjylland">Within Nordjylland</option>
			<option value="Region Sjælland">Within Sjælland</option>
			<option value="Region Syddanmark">Within Syddanmark</option>
		</select>
	</div>
</div>
<div class='vis' id='vis-gini'></div>





<script src="https://d3js.org/d3.v5.min.js"></script>


<script>

	function ginivis() {

		
		

		let data, time;
		let timeframe = "allday",
			level = "country",
			mode = 'relative';


		
		
		

		
		let maindiv = document.getElementById("vis-gini")
		let width = maindiv.offsetWidth - margin.left - margin.right,
			height = figureHeight - margin.top - margin.bottom;

		
		let x = d3.scaleTime().range([0, width]);
		let y = d3.scaleLinear().range([height, 0]);

		
		let xAxis = d3.axisBottom(x);
		let yAxis = d3.axisLeft(y);

		
		let valueline = d3.line()
			.x(function(d) { return x(d[0]); })
			.y(function(d) { return y(d[1]); });

		
		let svg = d3.select("#vis-gini")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
						"translate(" + margin.left + "," + margin.top + ")");

		
		svg.append("text")
			.attr("x", width/2)
			.attr("y", -15)
			.style("text-anchor", "middle")
			.style("font-weight", 700)
			.text("Change in population distribution across Denmark");

		
		svg.append("text")
			.attr("x", -60)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", 'toggleRelativegini')
			.style("text-anchor", "left")
			.style("font-weight", 700)
			.style('cursor', 'pointer')
			.text("rel")
			.on('click', handleTextClickGini)
		
		svg.append("text")
			.attr("x", -37)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", "toggleAbsgini")
			.style("text-anchor", "left")
			.style("font-weight", 300)
			.style('cursor', 'pointer')
			.text("abs")
			.on('click', handleTextClickGini)


		
		
		d3.json("/data/gini_over_time.json").then(function(data_) {

			
			data = data_;

			
			time = data._meta._meta.datetime.map(d => parseDate(d));
			let dt = d3.max(time);
			let d0 = parseDate(startDate);
			let n_days = (dt - d0 + 3.6e6) / 86.4e6
			let time_shown = d3.range(n_days+1).map(n => d0.addDays(n));

			
			let yrange = [-0.3, 0.8]
			x.domain(d3.extent(time_shown));
			y.domain(yrange);

			
			let idxwknd = d3.range(4, time_shown.length, 7);
			let dx = x(time[2]) - x(time[0]);
			let dy = y(yrange[0]) - y(yrange[1]);

			svg.selectAll('shade')
				.data(idxwknd).enter().append("rect")
				.attr("class", "shade")
				.attr("x", d => {
					return d == 0 ? x(time_shown[d]) : x(time_shown[d]) - dx/4
				})
				.attr("y", d => y(yrange[1]))
				.attr("width", d => {
					if (d == 0 | d == time_shown.length - 2) {
						return dx * 3/4;
					} else if (d == time_shown.length - 1) {
						return dx * 1/4;
					} else {
						return dx;
					}
				})
				.attr("height", dy)
				.style('fill', '#ecf0f1')
				.style('fill-opacity', 1)

			
			svg.append('rect')
				.attr('x', x(time_shown[0]))
				.attr('y', y(yrange[1]))
				.attr('width', x(time[0]) - x(time_shown[0]))
				.attr('height', dy)
				.attr('fill', 'url(#lines)')
				.attr('stroke-width', 1.5)
				.attr('fill-opacity', 0.2)
			svg.append('text')
				.attr('x', 10)
				.attr('y', 20)
				.style("font-weight", 0)
				.style("font-size", "12px")
				.text('NO DATA')

			
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			
			for (let d of eventDates) {  
				svg.append('line')
					.attr('class', 'histEvent')
					.attr('id', d[2] + "gini")
					.attr('x1', x(parseDate(d[0])))
					.attr('x2', x(parseDate(d[0])))
					.attr('y1', height)
					.attr('y2', height)
				svg.append('circle')
					.attr('class', 'histEventDot')
					.attr('cx', x(parseDate(d[0])))
					.attr('cy', height)
					.attr('r', 3)
					.on('mouseover', mouseover)
					.on('mousemove', () => {
						mousemoveHistEvent(d);
						d3.select("#" + d[2] + "gini").attr('y2', 0)
					})
					.on('mouseout', () => {
						mouseout();
						d3.select("#" + d[2] + "gini").attr('y2', height)
					})
			}

			
			svg.append('line')
				.attr('class', 'line')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 10)
				.attr('y2', 10)
			svg.append('circle')
				.attr('class', 'dot')
				.attr('cx', width+20)
				.attr('cy', 10)
				.attr('r', 2.5)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 10+4)
				.text('daily')
			svg.append('line')
				.attr('class', 'line-baseline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 30)
				.attr('y2', 30)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 30+4)
				.text('baseline')
			svg.append('line')
				.attr('class', 'trendline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 50)
				.attr('y2', 50)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 50+4)
				.text('7 day avg')

			visualize(data, timeframe, level);
		})
		
		d3.select('#placeGini')
			.on("change", () => {
				let dropdown = document.getElementById("placeGini");
				level = dropdown.options[dropdown.selectedIndex].value;
				d3.selectAll("#dataGini").remove();
				visualize(data, timeframe, level);
			});

		
		

		function visualize(data, timeframe, level) {

			if (mode == 'count') {
				yAxis = d3.axisLeft(y).ticks(6).tickFormat(v => v)
			} else if (mode == 'relative') {
				yAxis = d3.axisLeft(y).ticks(6, ".0%")
			}

			if (mode == 'count') {
				yrange = [0.49, 0.70];
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataGini")
					.call(yAxis);

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataGini")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Gini index");

				
				datum = zip(time, data[timeframe][level]['baseline']);
				datum = adjustBaseline(datum);
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-baseline')
					.attr("id", "dataGini")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot-baseline")
					.attr("id", "dataGini")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 3.5)
					.on('mouseover', d => {
						mouseover(d);
					})
					.on('mousemove', d => {
						mousemoveDot(d);
					})
					.on("mouseout", d => {
						mouseout(d);
					});
				datum = zip(time, weekavg(data[timeframe][level]['crisis']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataGini")
					.attr('d', valueline)
				datum = zip(time, data[timeframe][level]['crisis'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataGini")
					.attr('d', valueline)
				datum = zip(time, data[timeframe][level]['crisis'])
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataGini")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', d => {
						mouseover(d);
					})
					.on('mousemove', d => {
						mousemoveDot(d);
					})
					.on("mouseout", d => {
						mouseout(d);
					});

			} else if (mode == 'relative') {
				yrange = [d3.min(data[timeframe][level]['percent_change'])-0.1, d3.max(data[timeframe][level]['percent_change'])+0.1]
				y.domain(yrange);


				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataGini")
					.call(yAxis);

				
				datum = zip([parseDate(startDate), ...time], d3.range(time.length+1).map(() => 0))
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-horizontal')
					.attr("id", "dataGini")
					.attr('d', valueline)

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataGini")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Deviation from baseline");

				
				datum = zip(time, weekavg(data[timeframe][level]['percent_change']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataGini")
					.attr('d', valueline)
				datum = zip(time, data[timeframe][level]['percent_change'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataGini")
					.attr('d', valueline)
				datum = zip(time, data[timeframe][level]['percent_change'])
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataGini")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);
			}
		}

		
		function mousemoveDot(d) {
			let tooltiptext;
			if (mode == 'relative') {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Deviation: <b>" + Math.round(d[1]*100*1e1)/1e1 + "%</b>"
			} else {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Gini: <b>" + round(d[1], 1e3) + "</b>"
			}
			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX) + "px")
				.style("top", (d3.event.pageY) + "px");
		}

		function handleTextClickGini() {
			if (mode == 'count') {
				d3.select('#toggleRelativegini')
					.style('font-weight', 700);
				d3.select('#toggleAbsgini')
					.style('font-weight', 300);
				mode = "relative";
			} else {
				d3.select('#toggleRelativegini')
					.style('font-weight', 300);
				d3.select('#toggleAbsgini')
					.style('font-weight', 700);
				mode = "count";
			}
			d3.selectAll("#dataGini").remove();
			visualize(data, timeframe, level)
		}

		function update0() {
			d3.selectAll("#dataGini").remove();
			timeframe = 'allday';
			visualize(data, timeframe, level)
		}
		function update1() {
			d3.selectAll("#dataGini").remove();
			timeframe = '00';
			visualize(data, timeframe, level)
		}
		function update2() {
			d3.selectAll("#dataGini").remove();
			timeframe = '08';
			visualize(data, timeframe, level)
		}
		function update3() {
			d3.selectAll("#dataGini").remove();
			timeframe = '16';
			visualize(data, timeframe, level)
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2,
			update3: update3,
		}
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	let instance_gini = ginivis()
</script>












<p><strong>Observation 11:</strong> <em>Population concentration has decreased by 6-1%</em>. This is in terms of the Gini index. This concentration decrease (or &ldquo;spreading out&rdquo;) peaks over Easter which supports our observations above.</p>
<p><strong>Observation 12:</strong> <em>Population concentration is slowly increasing</em>. On week 14 during weekdays (March 30–April 3) the average deviation from baseline was -2.8%. By week 18 the weekday average deviation from baseline was -2.1%.</p>
<h2 id="data-description"><strong>Data description</strong></h2>
<p>Data was made available through Facebook&rsquo;s <a href="https://dataforgood.fb.com/">Data for Good</a> initiative. The earliest data made available starts March 28; at the lowest level it details population counts in geographical tiles up to 1.5 km by 1.5 km in size in three timebines each day (0–8, 8–16, and 16–24 GMT). Aggregation at the municipality level is also available. <strong>For privacy preservation</strong>, data is unavailale in tiles/municipalties where at a given time &lt; 10 people are present. For each count a corresponding <em>baseline</em> value is provided. The baseline is the average count for the same day and time over the 45 days prior to data generation. <strong>There are two important things to note about this data</strong>:</p>
<ul>
<li>Since the baseline averages over the 45 days prior to data generation, and data generation starts on March 28, around two weeks of the 45 baseline days span into the lockdown period. Therefore, by comparing to this baseline <strong>reported effects may be as much as 33% smaller</strong> than those we might have obtained if comparing to a baseline that did not include lockdown.</li>
<li>In any given time interval, the total number of counted individuals across the whole country is between 324.188 and 466.815 (<em>mean</em>: 421.500; <em>median</em>: 448.929; lowest between 0–8 GMT). These are Facebook users that actively use the mobile app at some time during an interval. <strong>To offer realistic population counts</strong> in the interactive visualization, we factor into the raw user counts the ratio between the total number of people in Denmark (5.787.997, as of Thursday, April 16, 202; source: <a href="https://www.worldometers.info/world-population/denmark-population/">Worldometer</a>) and the number of active users in a given time interval. This ratio varies between 13.8 and 17.9. Note, however, that the percentage change is computed <em>after</em> factoring in this ratio. This recalibration assumes that active Facebook users are distributed evenly throughout the population.</li>
</ul>
<!-- raw HTML omitted -->
<blockquote>
<p><strong>Update log</strong>:</p>
<p><em>17.4.2020</em>: The ratio between the total Danish population and the number of active Facebook users in a given time interval is now factored into the counts we display in the interactive population density map visualization. The percent change displayed is calculated from the recalibrated values. Affected text in <em>Data description</em> has been updated.</p>
<p><em>17.4.2020</em>: Sentence &ldquo;There are two important limitations in this data&rdquo; changed to &ldquo;There are two important things to note about this data&rdquo;.</p>
<p><em>17.4.2020</em>: Change recommendation from using <kbd>alt</kbd> for rotating view in interactive visualization to using <kbd>shift</kbd>. Both keys, however, work in most browsers.</p>
<p><em>18.4.2020</em>: Add button in visualization to change colorscheme. Rotates between five different schemes.</p>
<p><em>18.4.2020</em>: Add options to display y-axes as absolute. When absolute, it expresses <em>approximate number of individuals</em>. The ratio between the total Danish population and active users within the time window is factored into counts, same as in the visualization.</p>
<p><em>18.4.2020</em>: Add option in dropdown of &ldquo;Change in population size&rdquo; plot to display all municipalities at the same time.</p>
<p><em>20.4.2020</em>: Small improvements to text.</p>
<p><em>3.5.2020</em>: Add section &ldquo;Leaving home during the day&rdquo;.</p>
<p><em>4.5.2020</em>: Update all figures to display rolling 7-day average, legend, events and shade for period with no data.</p>
<p><em>4.5.2020</em>: Remove option to display 02–08 timeframe in all figures, as it is non-informative and only adds confusion.</p>
<p><em>4.5.2020</em>: Reformat text to explicitly state what our observations based on the figures are.</p>
</blockquote>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












