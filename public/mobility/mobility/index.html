<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Traveling patterns and mobility Report by Ulf Aslak and Sune Lehmann. Updated: May, 8, 2020 13:23:59
.vis { margin: 0 auto; height: 370px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-horizontal { stroke: #bdc3c7; stroke-width: 1; fill: none; stroke-dasharray: 10 5; } .line { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0.25; } .trendline { fill: none; stroke: red; stroke-width: 2.5; } ."><meta property="og:title" content="Travel and mobility" />
<meta property="og:description" content="Traveling patterns and mobility Report by Ulf Aslak and Sune Lehmann. Updated: May, 8, 2020 13:23:59
.vis { margin: 0 auto; height: 370px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-horizontal { stroke: #bdc3c7; stroke-width: 1; fill: none; stroke-dasharray: 10 5; } .line { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0.25; } .trendline { fill: none; stroke: red; stroke-width: 2.5; } ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://covid19.compute.dtu.dk/mobility/mobility/" />
<meta property="article:modified_time" content="2020-05-08T13:23:59+02:00" />
<title>Travel and mobility | COVID-19 mobility</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.e72951d38884f3b48fa43ce2d729bd3729c1122733c26acf563840728c13c88f.css" integrity="sha256-5ylR04iE87SPpDzi1ym9NynBEiczwmrPVjhAcowTyI8=">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/dtu.png" alt="Logo" /><span>COVID-19 mobility</span>
  </a>
</h2>












  <ul>
<li><strong><a href="/">Main Page</a></strong></li>
<li><strong>Posts</strong>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><em>May</em>
<ul>
<li><a href="/posts/change_in_population_sizes/">11: What&rsquo;s happening in my city?</a></li>
<li><a href="/posts/population_landscape/">7: Population landscape</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Visualizations</strong>
<ul>
<li><em>Where people are</em>
<ul>
<li><a href="/visualizations/where_people_are_landscape/">Landscape</a></li>
<li><a href="/visualizations/where_people_are_going_out/">Going out</a></li>
<li><a href="/visualizations/where_people_are_change_in_population_size/">Change in population size</a></li>
<li><a href="/visualizations/where_people_are_population_concentration/">Population distribution</a></li>
</ul>
</li>
<li><em>How people move</em>
<ul>
<li><a href="/visualizations/how_people_move_distance_traveled/">Distance traveled</a></li>
<li><a href="/visualizations/how_people_move_staying_home/">Staying home</a></li>
</ul>
<!-- raw HTML omitted -->
</li>
</ul>
</li>
<li><strong>Data</strong>
<ul>
<li><a href="/data/population_density_maps/">Population Density Maps</a></li>
<li><a href="/data/movement_maps/">Movement Maps</a>
<!-- raw HTML omitted --></li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Travel and mobility</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="traveling-patterns-and-mobility"><strong>Traveling patterns and mobility</strong></h1>
<p><span style="font-size:14px"><em>Report by <a href="mailto:ulfaslak@gmail.com">Ulf Aslak</a> and <a href="mailto:sljo@dtu.dk">Sune Lehmann</a>.</em></span> <span style="font-size:14px"><em>Updated: May, 8, 2020 13:23:59</em></span></p>




<style type="text/css">
	.vis {
		margin: 0 auto;
		height: 370px;
	}
	.line-baseline { 
		stroke: black;
		stroke-width: 1.5;
		fill: none;
		stroke-dasharray: 10 5;
		opacity: 0.2;
	}
	.line-horizontal { 
		stroke: #bdc3c7;
		stroke-width: 1;
		fill: none;
		stroke-dasharray: 10 5;
	}
	.line { 
		fill: none;
		stroke: black;
		stroke-width: 2;
		stroke-opacity: 0.25;
	}
	.trendline {
		fill: none; 
		stroke: red;
		stroke-width: 2.5;
	}
	.histEvent {
		stroke: grey;
		stroke-width: 2;
		stroke-opacity: 1;
	}
	.histEventDot {
		fill: grey;
	}
	.dot-baseline {
		fill: white;
		stroke: #2c3e50;
		stroke-width: 2;
		opacity: 0;
	}
	.dot {
		fill: black;
		opacity: 0.5;
	}
	.legend-label {
		text-anchor: start;
		font-weight: 300;
		cursor: pointer;
	}
	.right-legend {
		font-size: 12px;
	}
	.tooltip {	
		position: absolute;
		top: 0;
		line-height: 1;
		font-weight: 500;
		padding: 12px;
		background: rgba(0, 0, 0, 0.8);
		color: #fff;
		border-radius: 2px;	
	}
	.toggle {
		-webkit-user-select: none;          
		-moz-user-select: none;  
		-ms-user-select: none;  
		user-select: none;  
	}
	.radio-group {
		position: absolute;
		border: solid 1px #999999;
		display: inline-block;
		border-radius: 5px;
		overflow: hidden;
	}
	.select-place {
		position: absolute;
		right: 0px;
	}
	.flex {
		display: flex;
	}
</style>






<div style="max-height: 0px">
	<svg>
	  <defs>
	    <pattern id="lines" height="10" width="10" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
	      <line x1="0" y1="4" x2="10" y2="4" stroke-width="2" stroke="black"/>
	    </pattern>
	  </defs>
	</svg>
	<svg>
	  <defs>
	    <pattern id="thinlines" height="5" width="5" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
	      <line x1="0" y1="1" x2="10" y2="1" stroke-width="0.5" stroke="grey"/>
	    </pattern>
	  </defs>
	</svg>
</div>






<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://unpkg.com/d3-simple-slider"></script>
<script src="https://unpkg.com/chroma-js@2.0.3/chroma.min.js"></script>

<script>

	
	
	let eventDates = [
		["2020-03-11 00:00:00", 'PM announces lockdown starting March 16', 'event1'],
		["2020-03-16 00:00:00", 'Lockdown officially begins', 'event2'],
		["2020-04-09 00:00:00", 'Skærtorsdag (public holiday during Easter)', 'event3'],
		["2020-04-10 00:00:00", 'Lockdown relaxations announced', 'event4'],
		["2020-04-15 00:00:00", 'Child-care soft-reopens', 'event5'],
		["2020-04-20 00:00:00", 'Small businesses open', 'event6'],
		["2020-04-27 00:00:00", 'IKEA opens (controversy)', 'event7'],
		["2020-05-08 00:00:00", 'Great prayer day (public holiday)', 'event8'],
		
		
	]

	let startDate = "2020-03-10 00:00:00";

	
	let tooltip = d3.select("body").append("div")
		.attr("class", "tooltip")
		.style("display", "none");

	
	let parseDate = d3.timeParse("%Y-%m-%d %H:%M:%S");
	let formatDate = d3.timeFormat("%e %B");

	
	let margin = {top: 70, right: 88, bottom: 30, left: 60},
		figureHeight = 370;



	
	

	
	function mouseover(d) {
		tooltip.style("display", "inline");
	}

	function mouseout(d) {
		tooltip.style("display", "none");
	}

	function mousemoveHistEvent(d) {
		tooltip
			.html("Date: <b>" + formatDate(parseDate(d[0])) + "</b><br>" + d[1] + "</b>")
			.style("left", (d3.event.pageX) + "px")
			.style("top", (d3.event.pageY) + "px");
	}

	
	function adjustBaseline(datum) {
		datumy = d3.range(7).map(() => []);
		datum.forEach((d, i) => {
		    datumy[i%7].push(d[1]);
		});
		datumy = datumy.map(d => d3.mean(d));
		return datum.map((d, i) => [d[0], datumy[i%7]]);
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	function round(val, order) {
		return Math.round(val * order) / order;
	}

	Date.prototype.addDays = function(n) {
	    let date = new Date(this.valueOf());
	    date.setDate(date.getDate() + n);
	    return date;
	}

	function weekavg(y) {
		let y_avg = [];
		y.forEach((v, i) => {
			let i0 = Math.max(0, i-3);
			let i1 = Math.min(y.length-1, i+4);
			y_avg.push(d3.mean(y.slice(i0, i1)));
		});
		return y_avg;
	}
</script>
<p>Human mobility is a proxy of overall activity within a country. As Denmark reopens, we gain insight to a number of important trends by carefully monitoring the state of mobility:</p>
<ul>
<li>How fast is activity returning to normal levels?</li>
<li>Can we see change points in the data as a result of new policies?</li>
<li>How is mobility between municipalities changing?</li>
<li>How much activity is there inside different regions? Is there any correlation between activity and disease spread?</li>
</ul>
<p>This (continuously updated) report adresses these questions. Data for this report are <em>Movement Maps</em> and were provided by the Facebook&rsquo;s <a href="https://dataforgood.fb.com/">Data for Good</a> initiative; please see the section <em>Data description</em> at the bottom of this page for descriptive details.</p>
<h2 id="analyses"><strong>Analyses</strong></h2>
<p>In the Movement Maps, the country is gridded into small tiles that are around 2.8 kilometers long and wide. Each day, in turn is split into three time intervals: 0–8, 8–16, and 16–24 (GMT). For each active user a line is drawn between the tile in which they spent most time in the last eight-hour time bin and the current eight-hour time bin. Facebook then aggregates these lines giving us the flow of people between tiles.</p>
<h2 id="distance-traveled"><strong>Distance traveled</strong></h2>
<p>By averaging the length of trips between tiles we get an estimate of the average distance traveled each day by users in the dataset. During the lockdown we should expect this quantity to be significantly reduced, primarily because people work from home.</p>
<div class="flex">
	<div class="flex"></div>
	<div>
		<select id="levelTravel">
			<option value="all"><em>Whole country</em></option>
			<option value="Aabenraa">Aabenraa</option>
			<option value="Aalborg">Aalborg</option>
			<option value="Aarhus">Aarhus</option>
			<option value="Albertslund">Albertslund</option>
			<option value="Allerød">Allerød</option>
			<option value="Assens">Assens</option>
			<option value="Ballerup">Ballerup</option>
			<option value="Billund">Billund</option>
			<option value="Brøndby">Brøndby</option>
			<option value="Brønderslev">Brønderslev</option>
			<option value="Dragør">Dragør</option>
			<option value="Egedal">Egedal</option>
			<option value="Esbjerg">Esbjerg</option>
			<option value="Faaborg-Midtfyn">Faaborg-Midtfyn</option>
			
			<option value="Favrskov">Favrskov</option>
			<option value="Faxe">Faxe</option>
			<option value="Fredensborg">Fredensborg</option>
			<option value="Fredericia">Fredericia</option>
			
			<option value="Frederikshavn">Frederikshavn</option>
			<option value="Frederikssund">Frederikssund</option>
			<option value="Furesø">Furesø</option>
			<option value="Gentofte">Gentofte</option>
			<option value="Gladsaxe">Gladsaxe</option>
			<option value="Glostrup">Glostrup</option>
			<option value="Greve">Greve</option>
			<option value="Gribskov">Gribskov</option>
			<option value="Guldborgsund">Guldborgsund</option>
			<option value="Haderslev">Haderslev</option>
			<option value="Halsnæs">Halsnæs</option>
			<option value="Hedensted">Hedensted</option>
			<option value="Helsingør">Helsingør</option>
			<option value="Herlev">Herlev</option>
			<option value="Herning">Herning</option>
			<option value="Hillerød">Hillerød</option>
			<option value="Hjørring">Hjørring</option>
			<option value="Holbæk">Holbæk</option>
			<option value="Holstebro">Holstebro</option>
			<option value="Horsens">Horsens</option>
			<option value="Hvidovre">Hvidovre</option>
			<option value="Høje-Taastrup">Høje-Taastrup</option>
			<option value="Hørsholm">Hørsholm</option>
			<option value="Ikast-Brande">Ikast-Brande</option>
			<option value="Ishøj">Ishøj</option>
			<option value="Jammerbugt">Jammerbugt</option>
			<option value="Kalundborg">Kalundborg</option>
			<option value="Kerteminde">Kerteminde</option>
			<option value="Kolding">Kolding</option>
			<option value="København">København</option>
			<option value="Køge">Køge</option>
			
			<option value="Lejre">Lejre</option>
			
			<option value="Lolland">Lolland</option>
			<option value="Lyngby-Taarbæk">Lyngby-Taarbæk</option>
			
			
			<option value="Middelfart">Middelfart</option>
			
			<option value="Norddjurs">Norddjurs</option>
			 
			<option value="Nyborg">Nyborg</option>
			<option value="Næstved">Næstved</option>
			<option value="Odder">Odder</option>
			<option value="Odense">Odense</option>
			<option value="Odsherred">Odsherred</option>
			<option value="Randers">Randers</option>
			<option value="Rebild">Rebild</option>
			<option value="Ringkøbing-Skjern">Ringkøbing-Skjern</option>
			<option value="Ringsted">Ringsted</option>
			<option value="Roskilde">Roskilde</option>
			<option value="Rudersdal">Rudersdal</option>
			<option value="Rødovre">Rødovre</option>
			
			<option value="Silkeborg">Silkeborg</option>
			<option value="Skanderborg">Skanderborg</option>
			<option value="Skive">Skive</option>
			<option value="Slagelse">Slagelse</option>
			<option value="Solrød">Solrød</option>
			<option value="Sorø">Sorø</option>
			<option value="Stevns">Stevns</option>
			<option value="Struer">Struer</option>
			<option value="Svendborg">Svendborg</option>
			<option value="Syddjurs">Syddjurs</option>
			<option value="Sønderborg">Sønderborg</option>
			<option value="Thisted">Thisted</option>
			<option value="Tårnby">Tårnby</option>
			
			<option value="Vallensbæk">Vallensbæk</option>
			<option value="Varde">Varde</option>
			<option value="Vejen">Vejen</option>
			<option value="Vejle">Vejle</option>
			
			<option value="Viborg">Viborg</option>
			<option value="Vordingborg">Vordingborg</option>
			
		</select>
	</div>
</div>

<div class='vis' id="visTravel"></div>






<script src="https://d3js.org/d3.v5.min.js"></script>


<script>

	function travelvis() {

		
		

		let data, time;
		let level = "all",
			mode = 'count';


		
		
		

		
		let maindiv = document.getElementById("visTravel")
		let width = maindiv.offsetWidth - margin.left - margin.right,
			height = figureHeight - margin.top - margin.bottom;

		
		let x = d3.scaleTime().range([0, width]);
		let y = d3.scaleLinear().range([height, 0]);

		
		
		let xAxis = d3.axisBottom(x);
		let yAxis = d3.axisLeft(y).ticks(5);

		
		let valueline = d3.line()
			.x(function(d) { return x(d[0]); })
			.y(function(d) { return y(d[1]); });

		
		let svg = d3.select("#visTravel")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
						"translate(" + margin.left + "," + margin.top + ")");

		
		svg.append("text")
			.attr("x", width/2)
			.attr("y", -15)
			.style("text-anchor", "middle")
			.style("font-weight", 700)
			.text("Per capita travel");

		
		svg.append("text")
			.attr("x", -60)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", 'toggleRelativetravel')
			.style("text-anchor", "left")
			.style("font-weight", 300)
			.style('cursor', 'pointer')
			.text("rel")
			.on('click', handleTextClickTravel);
		
		svg.append("text")
			.attr("x", -37)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", "toggleAbstravel")
			.style("text-anchor", "left")
			.style("font-weight", 700)
			.style('cursor', 'pointer')
			.text("abs")
			.on('click', handleTextClickTravel);

		
		
		d3.json("/data/total_displacement.json").then(function(data_) {

			
			data = data_;

			
			time = data._meta.datetime.map(d => parseDate(d));
			let dt = d3.max(time);
			let d0 = parseDate(startDate);
			let n_days = (dt - d0 + 3.6e6) / 86.4e6
			let time_shown = d3.range(n_days+1).map(n => d0.addDays(n));

			
			let yrange = [0, d3.max(data[level]['crisis'])*1.2]
			x.domain(d3.extent(time_shown));
			y.domain(yrange);

			
			let idxwknd = d3.range(4, time_shown.length, 7);
			let dx = x(time[2]) - x(time[0]);
			let dy = y(yrange[0]) - y(yrange[1]);
			svg.selectAll('shade')
				.data(idxwknd)
				.enter().append("rect")
				.attr("class", "shade")
				.attr("x", d => {
					return d == 0 ? x(time_shown[d]) : x(time_shown[d]) - dx/4
				})
				.attr("y", d => y(yrange[1]))
				.attr("width", d => {
					if (d == 0 | d == time_shown.length - 2) {
						return dx * 3/4;
					} else if (d == time_shown.length - 1) {
						return dx * 1/4;
					} else {
						return dx;
					}
				})
				.attr("height", dy)
				.style('fill', '#ecf0f1')
				.style('fill-opacity', 1)

			
			svg.append('rect')
				.attr('x', x(time_shown[0]))
				.attr('y', y(yrange[1]))
				.attr('width', x(time[0]) - x(time_shown[0]))
				.attr('height', dy)
				.attr('fill', 'url(#lines)')
				.attr('stroke-width', 1.5)
				.attr('fill-opacity', 0.2)
			svg.append('text')
				.attr('x', 10)
				.attr('y', 20)
				.style("font-weight", 0)
				.style("font-size", "12px")
				.text('NO DATA')

			
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			
			for (let d of eventDates) {  
				svg.append('line')
					.attr('class', 'histEvent')
					.attr('id', d[2] + "travel")
					.attr('x1', x(parseDate(d[0])))
					.attr('x2', x(parseDate(d[0])))
					.attr('y1', height)
					.attr('y2', height)
				svg.append('circle')
					.attr('class', 'histEventDot')
					.attr('cx', x(parseDate(d[0])))
					.attr('cy', height)
					.attr('r', 3)	
					.on('mouseover', () => {
						mouseover(d);
						mousemoveHistEvent(d);
					})
					.on('mousemove', () => {
						mousemoveHistEvent(d);
						d3.select("#" + d[2] + "travel").attr('y2', 0);
					})
					.on('mouseout', () => {
						mouseout();
						d3.select("#" + d[2] + "travel").attr('y2', height)
					})
			}

			
			svg.append('line')
				.attr('class', 'line')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 10)
				.attr('y2', 10)
			svg.append('circle')
				.attr('class', 'dot')
				.attr('cx', width+20)
				.attr('cy', 10)
				.attr('r', 2.5)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 10+4)
				.text('daily')
			svg.append('line')
				.attr('class', 'line-baseline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 30)
				.attr('y2', 30)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 30+4)
				.text('baseline')
			svg.append('line')
				.attr('class', 'trendline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 50)
				.attr('y2', 50)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 50+4)
				.text('7 day avg')
			
			visualize(data, level);
		})

		d3.select('#levelTravel')
			.on("change", () => {
				let dropdown = document.getElementById("levelTravel");
				level = dropdown.options[dropdown.selectedIndex].value;
				d3.selectAll("#dataTravel").remove();
				visualize(data, level);
			});

		
		

		function visualize(data, level) {

			if (mode == 'count') {
				yrange = [0, d3.max([...data[level]['crisis'], ...data[level]['baseline']])*1.2]
				yAxis = d3.axisLeft(y).ticks(6).tickFormat(v => v)
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataTravel")
					.call(yAxis);

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataTravel")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Daily dist. traveled [km]");

				
				let datum = zip(time, data[level]['baseline']);
				datum = adjustBaseline(datum);
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-baseline')
					.attr("id", "dataTravel")
					.attr('d', valueline)
				svg.selectAll("dot-baseline")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot-baseline")
					.attr("id", "dataTravel")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 3.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);
				datum = zip(time, weekavg(data[level]['crisis']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataTravel")
					.attr('d', valueline)
				datum = zip(time, data[level]['crisis'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataTravel")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataTravel")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);

			} else if (mode == 'relative') {
				yAxis = d3.axisLeft(y).ticks(6, ".0%")
				yrange = [-1, 0.2]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataTravel")
					.call(yAxis);

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataTravel")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Deviation from baseline");

				
				datum = zip(time, weekavg(data[level]['percent_change']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataTravel")
					.attr('d', valueline)
				datum = zip(time, data[level]['percent_change'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataTravel")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataTravel")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);

				
				datum = zip(time, data[level]['percent_change'].map(() => 0))
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-horizontal')
					.attr("id", "dataTravel")
					.attr('d', valueline)
			}
		}

		
		

		
		function mousemoveDot(d) {
			let tooltiptext;
			if (mode == 'relative') {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Deviation: <b>" + Math.round(d[1]*100*1e1)/1e1 + "%</b>"
			} else {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Distance: <b>" + round(d[1] * 1000, 1e1) + " m</b>"
			}
			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX) + "px")
				.style("top", (d3.event.pageY) + "px");
		}
		function handleTextClickTravel() {
			if (mode == 'count') {
				d3.select('#toggleRelativetravel')
					.style('font-weight', 700);
				d3.select('#toggleAbstravel')
					.style('font-weight', 300);
				mode = "relative";
			} else {
				d3.select('#toggleRelativetravel')
					.style('font-weight', 300);
				d3.select('#toggleAbstravel')
					.style('font-weight', 700);
				mode = "count";
			}
			d3.selectAll("#dataTravel").remove();
			visualize(data, level);
		}
		function update0() {
			d3.selectAll("#dataTravel").remove();
			level = 'all';
			visualize(data, level);
		}
		function update1() {
			d3.selectAll("#dataTravel").remove();
			level = 'within_kommune';
			visualize(data, level);
		}
		function update2() {
			d3.selectAll("#dataTravel").remove();
			level = 'within_region';
			visualize(data, level);
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2
		}
	}

	
	let instance_travel = travelvis()
</script>
<p>Plotting this data reveals, as expected, a significant reduction in mobility.</p>
<h2 id="staying-near-home"><strong>Staying near home</strong></h2>
<div class="flex">
	<div class="flex"></div>
	<div>
		<select id="levelStation">
			<option value="all"><em>Whole country</em></option>
			<option value="Aabenraa">Aabenraa</option>
			<option value="Aalborg">Aalborg</option>
			<option value="Aarhus">Aarhus</option>
			<option value="Albertslund">Albertslund</option>
			
			
			<option value="Ballerup">Ballerup</option>
			<option value="Billund">Billund</option>
			<option value="Brøndby">Brøndby</option>
			<option value="Brønderslev">Brønderslev</option>
			<option value="Dragør">Dragør</option>
			<option value="Egedal">Egedal</option>
			<option value="Esbjerg">Esbjerg</option>
			
			
			
			
			<option value="Fredensborg">Fredensborg</option>
			<option value="Fredericia">Fredericia</option>
			
			<option value="Frederikshavn">Frederikshavn</option>
			
			<option value="Furesø">Furesø</option>
			<option value="Gentofte">Gentofte</option>
			<option value="Gladsaxe">Gladsaxe</option>
			<option value="Glostrup">Glostrup</option>
			<option value="Greve">Greve</option>
			
			<option value="Guldborgsund">Guldborgsund</option>
			<option value="Haderslev">Haderslev</option>
			<option value="Halsnæs">Halsnæs</option>
			
			<option value="Helsingør">Helsingør</option>
			<option value="Herlev">Herlev</option>
			<option value="Herning">Herning</option>
			<option value="Hillerød">Hillerød</option>
			<option value="Hjørring">Hjørring</option>
			<option value="Holbæk">Holbæk</option>
			<option value="Holstebro">Holstebro</option>
			<option value="Horsens">Horsens</option>
			<option value="Hvidovre">Hvidovre</option>
			<option value="Høje-Taastrup">Høje-Taastrup</option>
			
			<option value="Ikast-Brande">Ikast-Brande</option>
			<option value="Ishøj">Ishøj</option>
			
			
			
			<option value="Kolding">Kolding</option>
			<option value="København">København</option>
			<option value="Køge">Køge</option>
			
			
			
			<option value="Lolland">Lolland</option>
			<option value="Lyngby-Taarbæk">Lyngby-Taarbæk</option>
			
			
			
			
			<option value="Norddjurs">Norddjurs</option>
			 
			<option value="Nyborg">Nyborg</option>
			<option value="Næstved">Næstved</option>
			
			<option value="Odense">Odense</option>
			
			<option value="Randers">Randers</option>
			
			
			<option value="Ringsted">Ringsted</option>
			<option value="Roskilde">Roskilde</option>
			
			<option value="Rødovre">Rødovre</option>
			
			<option value="Silkeborg">Silkeborg</option>
			
			<option value="Skive">Skive</option>
			<option value="Slagelse">Slagelse</option>
			
			
			
			
			<option value="Svendborg">Svendborg</option>
			
			
			<option value="Thisted">Thisted</option>
			<option value="Tårnby">Tårnby</option>
			
			<option value="Vallensbæk">Vallensbæk</option>
			
			
			<option value="Vejle">Vejle</option>
			
			<option value="Viborg">Viborg</option>
			
			
		</select>
	</div>
</div>

<div class='vis' id="visStation"></div>





<script src="https://d3js.org/d3.v5.min.js"></script>


<script>

	function stationvis() {

		
		

		let data, datum, time;
		let level = "all",
			mode = 'count';


		
		
		

		
		let maindiv = document.getElementById("visStation")
		let width = maindiv.offsetWidth - margin.left - margin.right,
			height = figureHeight - margin.top - margin.bottom;

		
		let x = d3.scaleTime().range([0, width]);
		let y = d3.scaleLinear().range([height, 0]);

		
		let xAxis = d3.axisBottom(x);
		let yAxis = d3.axisLeft(y).ticks(6, ".0%");

		
		let valueline = d3.line()
			.x(function(d) { return x(d[0]); })
			.y(function(d) { return y(d[1]); });

		
		let svg = d3.select("#visStation")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
						"translate(" + margin.left + "," + margin.top + ")");

		
		svg.append("text")
			.attr("x", width/2)
			.attr("y", -15)
			.style("text-anchor", "middle")
			.style("font-weight", 700)
			.text("Staying at (or near) home");

		
		svg.append("text")
			.attr("x", -60)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", 'toggleRelativestation')
			.style("text-anchor", "left")
			.style("font-weight", 300)
			.style('cursor', 'pointer')
			.text("rel")
			.on('click', handleTextClickStation);

		
		svg.append("text")
			.attr("x", -37)
			.attr("y", -15)
			.attr('class', 'toggle')
			.attr("id", "toggleAbsstation")
			.style("text-anchor", "left")
			.style("font-weight", 700)
			.style('cursor', 'pointer')
			.text("abs")
			.on('click', handleTextClickStation);

		
		
		d3.json("/data/total_stationarity.json").then(function(data_) {

			
			data = data_;

			
			time = data._meta.datetime.map(d => parseDate(d));
			let dt = d3.max(time);
			let d0 = parseDate(startDate);
			let n_days = (dt - d0 + 3.6e6) / 86.4e6
			let time_shown = d3.range(n_days+1).map(n => d0.addDays(n));

			
			let yrange = [-0.05, 0.3]
			x.domain(d3.extent(time_shown));
			y.domain(yrange);

			
			let idxwknd = d3.range(4, time_shown.length, 7);
			let dx = x(time[2]) - x(time[0]);
			let dy = y(yrange[0]) - y(yrange[1]);
			svg.selectAll('shade')
				.data(idxwknd)
				.enter().append("rect")
				.attr("class", "shade")
				.attr("x", d => {
					return d == 0 ? x(time_shown[d]) : x(time_shown[d]) - dx/4
				})
				.attr("y", d => y(yrange[1]))
				.attr("width", d => {
					if (d == 0 | d == time_shown.length - 2) {
						return dx * 3/4;
					} else if (d == time_shown.length - 1) {
						return dx * 1/4;
					} else {
						return dx;
					}
				})
				.attr("height", dy)
				.style('fill', '#ecf0f1')
				.style('fill-opacity', 1)

			
			svg.append('rect')
				.attr('x', x(time_shown[0]))
				.attr('y', y(yrange[1]))
				.attr('width', x(time[0]) - x(time_shown[0]))
				.attr('height', dy)
				.attr('fill', 'url(#lines)')
				.attr('stroke-width', 1.5)
				.attr('fill-opacity', 0.2)
			svg.append('text')
				.attr('x', 10)
				.attr('y', 20)
				.style("font-weight", 0)
				.style("font-size", "12px")
				.text('NO DATA')

			
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			
			for (let d of eventDates) {  
				svg.append('line')
					.attr('class', 'histEvent')
					.attr('id', d[2] + "station")
					.attr('x1', x(parseDate(d[0])))
					.attr('x2', x(parseDate(d[0])))
					.attr('y1', height)
					.attr('y2', height)
				svg.append('circle')
					.attr('class', 'histEventDot')
					.attr('cx', x(parseDate(d[0])))
					.attr('cy', height)
					.attr('r', 3)
					.on('mouseover', mouseover)
					.on('mousemove', () => {
						mousemoveHistEvent(d);
						d3.select("#" + d[2] + "station").attr('y2', 0)
					})
					.on('mouseout', () => {
						mouseout();
						d3.select("#" + d[2] + "station").attr('y2', height)
					})
			}

			
			svg.append('line')
				.attr('class', 'line')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 10)
				.attr('y2', 10)
			svg.append('circle')
				.attr('class', 'dot')
				.attr('cx', width+20)
				.attr('cy', 10)
				.attr('r', 2.5)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 10+4)
				.text('daily')
			svg.append('line')
				.attr('class', 'line-baseline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 30)
				.attr('y2', 30)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 30+4)
				.text('baseline')
			svg.append('line')
				.attr('class', 'trendline')
				.attr('x1', width+10)
				.attr('x2', width+30)
				.attr('y1', 50)
				.attr('y2', 50)
			svg.append('text')
				.attr('class', 'right-legend')
				.attr('x', width+35)
				.attr('y', 50+4)
				.text('7 day avg')
			
			visualize(data, level);
		})

		d3.select('#levelStation')
			.on("change", () => {
				let dropdown = document.getElementById("levelStation");
				level = dropdown.options[dropdown.selectedIndex].value;
				d3.selectAll("#dataStation").remove();
				visualize(data, level);
			});

		
		
		function visualize(data, level) {

			if (mode == 'count') {
				yrange = [0.6, 1.05]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataStation")
					.call(yAxis);

				
				datum = zip([parseDate(startDate), ...time], d3.range(time.length+1).map(() => 1))
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-horizontal')
					.attr("id", "dataStation")
					.attr('d', valueline)

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataStation")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Share of population");

				
				datum = zip(time, data[level]['baseline']);
				datum = adjustBaseline(datum);
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-baseline')
					.attr("id", "dataStation")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot-baseline")
					.attr("id", "dataStation")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 3.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);
				datum = zip(time, weekavg(data[level]['crisis']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataStation")
					.attr('d', valueline)
				datum = zip(time, data[level]['crisis'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataStation")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataStation")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);

			} else if (mode == 'relative') {
				yrange = [-0.05, 0.3]
				y.domain(yrange);

				
				svg.append("g")
					.attr("class", "y axis")
					.attr("id", "dataStation")
					.call(yAxis);

				
				datum = zip([parseDate(startDate), ...time], d3.range(time.length+1).map(() => 0))
				svg.append("path")
					.datum(datum)
					.attr('class', 'line-horizontal')
					.attr("id", "dataStation")
					.attr('d', valueline)

				
				svg.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", -40)
					.attr("x", -height / 2)
					.attr("id", "dataStation")
					.style("text-anchor", "middle")
					.style("font-weight", 500)
					.text("Deviation from baseline");

				
				datum = zip(time, weekavg(data[level]['percent_change']))
				svg.append("path")
					.datum(datum)
					.attr('class', 'trendline')
					.attr("id", "dataStation")
					.attr('d', valueline)
				datum = zip(time, data[level]['percent_change'])
				svg.append("path")
					.datum(datum)
					.attr('class', 'line')
					.attr("id", "dataStation")
					.attr('d', valueline)
				svg.selectAll("dot")
					.data(datum)
					.enter().append("circle")
					.attr("class", "dot")
					.attr("id", "dataStation")
					.attr("cx", d => x(d[0]))
					.attr("cy", d => y(d[1]))
					.attr("r", 2.5)
					.on('mouseover', mouseover)
					.on('mousemove', mousemoveDot)
					.on("mouseout", mouseout);
			}
		}

		
		

		
		function mousemoveDot(d) {
			let tooltiptext;
			if (mode == 'relative') {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Deviation: <b>" + Math.round(d[1]*100*1e1)/1e1 + "%</b>"
			} else {
				tooltiptext = "Date: <b>" + formatDate(d[0]) + "</b><br>" + "Population: <b>" + round(d[1] * 100, 1e1) + "%</b>"
			}

			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX) + "px")
				.style("top", (d3.event.pageY) + "px");
		}
		function handleTextClickStation() {
			if (mode == 'count') {
				d3.select('#toggleRelativestation')
					.style('font-weight', 700);
				d3.select('#toggleAbsstation')
					.style('font-weight', 300);
				mode = "relative";
			} else {
				d3.select('#toggleRelativestation')
					.style('font-weight', 300);
				d3.select('#toggleAbsstation')
					.style('font-weight', 700);
				mode = "count";
			}
			d3.selectAll("#dataStation").remove();
			visualize(data, level);
		}
		function update0() {
			d3.selectAll("#dataStation").remove();
			level = 'all';
			visualize(data, level);
		}
		function update1() {
			d3.selectAll("#dataStation").remove();
			level = 'within_kommune';
			visualize(data, level);
		}
		function update2() {
			d3.selectAll("#dataStation").remove();
			level = 'within_region';
			visualize(data, level);
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2
		}
	}

	
	let instance_station = stationvis()
</script>
<h2 id="mapping-movements-between-municipalities"><strong>Mapping movements between municipalities</strong></h2>



<style>
	.vis-movements {
		margin: 0 auto;
		height: 660px;
	}
	.map-polygon-movements {
		stroke: white;
		stroke-width: 0.3;
	}
	input.movements[type=radio] {
		position: absolute;
		visibility: hidden;
		display: none;
	}

	label.movements {
		color: #222222;
		display: inline-block;
		font-size: 12px;
		font-weight: 500;
		padding: 0px 5px 0px 5px;
	}

	input.movements[type=radio]:checked + label.movements{
		color: #ffffff;
		background: #555555;
		cursor: pointer;
	}

	label.movements + input.movements[type=radio] + label.movements {
		border-left: solid 1px #999999;
		cursor: pointer;
	}
</style>




<div class="flex">
	<div class="flex radio-group">
		<input class="movements" onclick="instance_movements.update0()" type="radio" id="option-zero-movements" name="selector-movements" checked>
		<label class="movements" for="option-zero-movements">Lockdown</label>
		<input class="movements" onclick="instance_movements.update1()" type="radio" id="option-one-movements" name="selector-movements">
		<label class="movements" for="option-one-movements">Baseline</label>
		<input class="movements" onclick="instance_movements.update2()" type="radio" id="option-two-movements" name="selector-movements">
		<label class="movements" for="option-two-movements">Change</label>
	</div>
</div>

<div class='vis-movements' id='vis-movements'></div>

<div class="slider-container">
	<div id="slider-step"></div>
</div>






<script>

	function movementsvis() {

		
		

		let geoData, data,
			namePolygonMap = {},
			t = 0,
			mode = "crisis";
			withinMax = 0,
			outMax = 0,
			inMax = 0,
			selected = undefined;


		
		
		

		
		let maindiv = document.getElementById("vis-movements")
		let margin_ = {top: 70, right: 5, bottom: 30, left: 60},
			width = 770 - margin_.left - margin_.right,
			height = 660 - margin_.top - margin_.bottom;

		
		
		let svg = d3.select("#vis-movements")
			.append("svg")
				.attr("width", width + margin_.left + margin_.right)
				.attr("height", height + margin_.top + margin_.bottom);

		
		let g = svg.append("g");
				
				

		
		let zoom = d3.zoom()
			.extent([[100, 18], [width, height]])
			.scaleExtent([1, 4])
			.on("zoom", zoomed);

		svg.call(zoom);

		
		let x = d3.scaleLinear().domain([7.9-1.2, 12.81+1.2]).range([0, width]);
		let y = d3.scaleLinear().domain([54.53+0.3, 57.82+0.3]).range([height, 0]);

		
		d3.json("/data/geojson_dk.json").then(function(data_) {

			
			geoData = data_;

			
			geoData.forEach(d => {
				namePolygonMap[d.kommune] = d.polygons;
			})
			
			
			d3.json("/data/movements_between_admin_regions.json").then(function(data_) {

				
				data = data_;

				
				
				let N = data._meta.datetime.length
				let sliderStep = d3.sliderBottom()
					.min(0)
					.max(N-1)
					.width(width)
					.tickValues(d3.range(1, N, 7))
					.tickFormat(idxToDate)
					.step(1)
					.default(0)
					.on('onchange', _t => {
						t = _t;
						visualize(geoData, _t, data, mode);
					});

				
				let gStep = d3.select('div#slider-step')
					.append('svg')
					.attr('width', width + 60)
					.attr('height', 100)
					.append('g')
					.attr('transform', 'translate(40,55)');
				gStep.call(sliderStep);

				
				visualize(geoData, t, data, mode);
			})
		})


		
		

		function visualize(geoData, t, data, mode) {
			
			
			
			let domain,
				legendRange,
				legendTitle,
				n_steps = 5;
			if (mode == "percent_change") {
				domain = [1, -1];  
				legendRange = d3.range(-n_steps, n_steps)
				legendTitle = "Percent change";
			}
			else {
				domain = [-data._meta.inMax, data._meta.inMax];
				legendRange = d3.range(-1, n_steps)
				legendTitle = "Going to work";
			}
			
			
			colorScale.domain(domain)

			
			svg.selectAll('polygon').remove()
			svg.selectAll('rect').remove()
			svg.selectAll('text').remove()

			
			
			svg.append('text')
				.attr('x', width-53)
				.attr('y', 20)
				.attr('font-weight', 700)
				.text(legendTitle)

			
			legendRange.forEach((i, idx) => {

				
				svg.append('rect')
					.attr('x', width-53)
					.attr('y', idx * 23 + 40)
					.attr('width', 15)
					.attr('height', 15)
					.attr('fill', () => {
						if (idx == 0)
							return 'url(#thinlines)';
						else
							return colorScale(i / (n_steps-1) * domain[1]);
					})

				
				svg.append('text')
					.attr('x', width-30)
					.attr('y', idx * 23 + 52.5)
					.attr('font-size', 13)
					.text(() => {
						if (idx == 0)
							return "No data";
						else
							return round(i / (n_steps-1) * domain[1] * 100, 1e0) + "%";
					})
			})

			
			for (let datum of geoData) {
				g.selectAll(datum.kommune)
					.data(datum.polygons)
					.enter().append("polygon")
				    .attr("points", mp => mp.map(p => [x(p[0]), y(p[1])].join(",")).join(" "))
				    .attr("class", 'map-polygon-movements')
				    .attr("id", datum.kommune)
				    .style('fill', () => defaultFill(datum.kommune, t))
					.on('mouseover', mp => {
						if (datum.kommune in data) {
							mouseover();
							if (typeof selected == 'undefined')
								highlightRegion(datum.kommune, mp, 'black');
							else if (datum.kommune != selected) {
								highlightRegion(datum.kommune, mp, 'grey');
							}
						}
					})
					.on('mousemove', () => {
						if (typeof selected == 'undefined') {
							if (datum.kommune in data) 
								mousemoveDefaultMovements(datum.kommune, t);
						} else {
							if (datum.kommune in data[selected])
								mousemoveSelectedMovements(datum.kommune, t);
							else
								mouseout();

						}
					})
					.on('mouseout', mp => {
						mouseout();
						if (datum.kommune != selected)
							unhighlightRegion(datum.kommune, mp)
					})
					.on('click', mp => {
						if (datum.kommune in data) {
							if (typeof selected == 'undefined') {
								highlightRegion(datum.kommune, mp, 'black')
								recolorRegions(datum.kommune, t)
								selected = datum.kommune;
							} else {
								if (datum.kommune == selected) {
									unhighlightRegion(selected, mp);
									restoreDefault(t);
									selected = undefined;
								} else {
									unhighlightRegion(selected, mp);
									highlightRegion(datum.kommune, mp, 'black');
									recolorRegions(datum.kommune, t);
									selected = datum.kommune;
								}
							}
						}
					});


			}
		}

		let colorScale = chroma.scale(['#b71540', '#e55039', '#C4C4C4', '#4a69bd', '#0c2461'])

		function pushPolygonToFront(d) {
			d3.selectAll("polygon").sort(a => {
		      	if (a != d) return -1
		      	else return 1;
		  	});
		}

		function pushMultiPolygonToFront(d) {
			d3.selectAll("polygon").sort(a => {
		      	if (!d.includes(a)) return -1
		      	else return 1;
		  	});
		}

		function highlightRegion(d, mp, color) {
			pushPolygonToFront(mp);
			d3.selectAll('#' + d)
				.style('stroke', color)
				.style('stroke-width', 1)
		}

		function unhighlightRegion(d, mp) {
			if (typeof selected != 'undefined') {
				pushMultiPolygonToFront(namePolygonMap[selected])
			}
			d3.selectAll('#' + d)
				.style('stroke', 'white')
				.style('stroke-width', 0.3)
		}

		function idxToDate(i) {
			let days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
			let date = new Date(2020, 2, 28);
			date.setHours(date.getHours() + 24 * i);
			let dateString = "";
			dateString += days[date.getDay()] + " ";
			dateString += date.getDate() + "/";
			dateString += date.getMonth() + 1
			return dateString
		}

		function mousemoveDefaultMovements(d, t) {
			let count = data[d][d][mode][t][0];

			let tooltiptext = "<b>" + d + "</b><br>";
			if (mode == 'percent_change')
				tooltiptext += "Deviation: <b>" + round(count*100, 1e1) + "%</b>";
			else
				tooltiptext += "Share: <b>" + round(data[d][d][mode][t][0] * 100, 1e1) + "%</b>";

			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX + 10) + "px")
				.style("top", (d3.event.pageY) + "px");
		}

		function mousemoveSelectedMovements(d, t) {
			let count = data[selected][d][mode][t][0];
			if (selected == d) {
				Object.keys(data[selected]).forEach(n => {
					if (n != d && t in data[selected][n][mode])
						count -= data[selected][n][mode][t][0];
				})
			}

			let tooltiptext = "<b>" + d + "</b><br>";
			if (mode == 'percent_change')
				tooltiptext += "Deviation: <b>" + round(count * 100, 1e1) + "%</b>";
			else
				tooltiptext += "Share: <b>" + round(count * 100, 1e2) + "%</b>";

			tooltip
				.html(tooltiptext)
				.style("left", (d3.event.pageX + 10) + "px")
				.style("top", (d3.event.pageY) + "px");
		}
		
		function defaultFill(d, t) {
			if (d in data && t in data[d]["_" + d][mode]) {
	    		let count = data[d]["_" + d][mode][t][0];
	    		return colorScale(count).hex();
	    	} else {
	    		return 'url(#thinlines)';
	    	}
		}

		function recolorRegions(d, t) {
			
			d3.selectAll('.map-polygon-movements')
				.style('fill', '#ecf0f1')

			
			Object.keys(data[d]).forEach(neighbor => {
				if (t in data[d][neighbor][mode]) {
					let count;
					if (neighbor != d) {
						count = data[d][neighbor][mode][t][0]
					} else {
						count = data[d][d][mode][t][0]
						Object.keys(data[d]).forEach(n => {
							if (n != d & t in data[d][n][mode])
								count -= data[d][n][mode][t][0]
						})
					}
					d3.selectAll('#' + neighbor)
						.style('fill', colorScale(count).hex())
				}
			})
		}

		function restoreDefault(t) {
			geoData.forEach(datum_ => {
				d3.selectAll('#' + datum_.kommune)
					.style('fill', defaultFill(datum_.kommune, t))
			})
		}

		function zoomed() {
			g.attr("transform", d3.event.transform);
		}

		document.onkeydown = evt => {
		    evt = evt || window.event;
		    if (evt.key === "Escape" || evt.key === "Esc") {
		    	selected = undefined;
		    	visualize(geoData, t, data, mode);
		    }
		};

		function update0() {
			mode = 'crisis';
			visualize(geoData, t, data, mode);
		}
		function update1() {
			mode = 'baseline';
			visualize(geoData, t, data, mode);
		}
		function update2() {
			mode = 'percent_change';
			visualize(geoData, t, data, mode);
		}

		return {
			update0: update0,
			update1: update1,
			update2: update2
		}
	}

	let instance_movements = movementsvis()
</script>
<h2 id="data-description"><strong>Data description</strong></h2>
<p>Data was made available through Facebook&rsquo;s <a href="https://dataforgood.fb.com/">Data for Good</a> initiative. The earliest data made available starts March 28; at the lowest level it details population counts in geographical tiles up to 3 km by 3 km in size in three timebines each day (0–8, 8–16, and 16–24 GMT). For this report we combine two aggregated datasets: mobility within municipalities tracks movements between tiles, and mobility between municipalities tracks movements between municipalities. The movements measured between tiles are much sparser due to Facebooks privacy preservation preprocessing steps. <strong>For privacy preservation</strong>, data is unavailale in tiles/municipalties where at a given time &lt; 10 people are present. This introduces an important limitation: It significantly reduces the amount of available data, because if for a given movement there is less than 10 active users present in either the source tile or the destination tile (which is likely), the movement is not reported. Therefore, in municipalies with little movement within, almost no data is available. Moreover, it biases <em>Distance traveled</em> (negatively) and <em>Staying near home</em> (positively).</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












